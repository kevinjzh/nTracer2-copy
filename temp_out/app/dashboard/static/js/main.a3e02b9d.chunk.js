(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[0],{23:function(e,t,n){},55:function(e,t,n){},89:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(45),c=n.n(o),i=(n(55),n(12)),s=n(13),l=n(5),d=n(4),u=n.n(d),p=n(6),f=n(3),b=n(2),m=(n(23),n(46)),j=a.a.createContext(null),g=n(0);function h(e){var t=e.saveLayerState,n=e.activeLayerName,a=e.layerOps,o=(e.trackTransforms,e.saveTrackTransforms),c=Object(r.useState)(0),d=Object(f.a)(c,2),b=d[0],h=d[1],R=Object(r.useState)(0),L=Object(f.a)(R,2),z=L[0],Y=L[1],X=Object(r.useState)(0),Z=Object(f.a)(X,2),E=Z[0],P=Z[1],D=Object(r.useState)(1),U=Object(f.a)(D,2),F=U[0],B=U[1],J=Object(r.useState)(1),q=Object(f.a)(J,2),H=q[0],K=q[1],G=Object(r.useState)(1),W=Object(f.a)(G,2),V=W[0],Q=W[1],$=Object(r.useState)(!1),te=Object(f.a)($,2),ne=te[0],re=te[1],ae=Object(r.useState)(!1),oe=Object(f.a)(ae,2),ce=oe[0],ie=oe[1],se=Object(r.useState)(!1),le=Object(f.a)(se,2),de=le[0],ue=le[1],pe=Object(r.useState)(0),fe=Object(f.a)(pe,2),be=fe[0],me=fe[1],je=Object(r.useState)(0),ge=Object(f.a)(je,2),he=ge[0],xe=ge[1],ye=Object(r.useState)(0),Oe=Object(f.a)(ye,2),ve=Oe[0],we=Oe[1],Ce=Object(r.useState)((function(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]})),ke=Object(f.a)(Ce,2),_e=ke[0],Se=ke[1],Ne=Object(r.useState)([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),Ie=Object(f.a)(Ne,2),Me=Ie[0],Te=Ie[1],Ae=Object(r.useState)({}),Re=Object(f.a)(Ae,2),Le=Re[0],ze=Re[1],Ye=Object(r.useContext)(j),Xe=Object(r.useState)(null),Ze=Object(f.a)(Xe,2),Ee=Ze[0],Pe=Ze[1],De=function(e,t){switch(e){case"translateX":return"Translate in X by ".concat(t);case"translateY":return"Translate in Y by ".concat(t);case"translateZ":return"Translate in Z by ".concat(t);case"rotateX":return"Rotate on X axis by ".concat(t," degrees");case"rotateY":return"Rotate on Y axis by ".concat(t," degrees");case"rotateZ":return"Rotate on Z axis by ".concat(t," degrees");case"scaleX":return"Scale in X by ".concat(t);case"scaleY":return"Scale in Y by ".concat(t);case"scaleZ":return"Scale in Z by ".concat(t);case"reflectX":return"Reflect on X axis";case"reflectY":return"Reflect on Y axis";case"reflectZ":return"Reflect on Z axis";default:return"Unknown transform ".concat(e," with value ").concat(t)}};Object(r.useEffect)((function(){if(null===Ye||void 0===Ye?void 0:Ye.current){var e=function(e){console.log("Received position:",e.position),Pe(e.position)};return Ye.current.on("position-updated",e),function(){Ye.current.off("position-updated",e)}}}),[Ye]);var Ue=function(e,t){var n="boolean"===typeof t||"-"===t?t:""===t?"":parseFloat(t),r={translateX:h,translateY:Y,translateZ:P,rotateX:me,rotateY:xe,rotateZ:we,scaleX:B,scaleY:K,scaleZ:Q,reflectX:re,reflectY:ie,reflectZ:ue};r[e]&&(r[e](n),Fe(e,n))},Fe=function(e,t){var n;switch(e){case"translateX":n=[[1,0,0,t],[0,1,0,0],[0,0,1,0],[0,0,0,1]];break;case"translateY":n=[[1,0,0,0],[0,1,0,t],[0,0,1,0],[0,0,0,1]];break;case"translateZ":n=[[1,0,0,0],[0,1,0,0],[0,0,1,t],[0,0,0,1]];break;case"rotateX":var r=t*Math.PI/180,a=Math.cos(r),o=Math.sin(r);n=[[1,0,0,0],[0,a,-o,0],[0,o,a,0],[0,0,0,1]];break;case"rotateY":var c=t*Math.PI/180,i=Math.cos(c),s=Math.sin(c);n=[[i,0,s,0],[0,1,0,0],[-s,0,i,0],[0,0,0,1]];break;case"rotateZ":var l=t*Math.PI/180,d=Math.cos(l),u=Math.sin(l);n=[[d,-u,0,0],[u,d,0,0],[0,0,1,0],[0,0,0,1]];break;case"scaleX":n=[[t,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];break;case"scaleY":n=[[1,0,0,0],[0,t,0,0],[0,0,1,0],[0,0,0,1]];break;case"scaleZ":n=[[1,0,0,0],[0,1,0,0],[0,0,t,0],[0,0,0,1]];break;case"reflectX":n=[[t?-1:1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];break;case"reflectY":n=[[1,0,0,0],[0,t?-1:1,0,0],[0,0,1,0],[0,0,0,1]];break;case"reflectZ":n=[[1,0,0,0],[0,1,0,0],[0,0,t?-1:1,0],[0,0,0,1]];break;default:n=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}Te(n)},Be=function(e,t){return Array.isArray(e)&&Array.isArray(t)&&Array.isArray(t[0])?e.map((function(e,n){return t[0].map((function(n,r){return e.reduce((function(e,n,a){return e+n*t[a][r]}),0)}))})):(console.error("Invalid matrices passed to multiplyMatrices:",e,t),[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])};Object(r.useEffect)((function(){var e=Ee||[0,0,0],t=Object(f.a)(e,3),r=[t[0],t[1],t[2],1];console.log("Previous transform:",Me);var o=function(e,t){return Array.isArray(e)&&4===e.length&&Array.isArray(t)&&4===t.length?t[0].map((function(n,r){return e.reduce((function(e,n,a){return e+n*t[a][r]}),0)})):(console.error("Invalid vector or matrix in multiplyVectorMatrix",e,t),[0,0,0,1])}(r,Me).slice(0,3),c=Object(f.a)(o,3),d=c[0],j=c[1],g=c[2],h=be*Math.PI/180,x=he*Math.PI/180,y=ve*Math.PI/180,O=Math.cos(h),v=Math.sin(h),w=Math.cos(x),C=Math.sin(x),k=Math.cos(y),_=Math.sin(y),S=Be([[1,0,0,b],[0,1,0,z],[0,0,1,E],[0,0,0,1]],Be([[k,-_,0,d*(1-k)+j*_],[_,k,0,j*(1-k)-d*_],[0,0,1,0],[0,0,0,1]],Be([[w,0,C,d*(1-w)-g*C],[0,1,0,0],[-C,0,w,g*(1-w)+d*C],[0,0,0,1]],Be([[1,0,0,0],[0,O,-v,j*(1-O)+g*v],[0,v,O,g*(1-O)-j*v],[0,0,0,1]],Be([[F,0,0,d*(1-F)],[0,H,0,j*(1-H)],[0,0,V,g*(1-V)],[0,0,0,1]],[[ne?-1:1,0,0,ne?2*d:0],[0,ce?-1:1,0,ce?2*j:0],[0,0,de?-1:1,de?2*g:0],[0,0,0,1]])))));Se(S),function(){var e=Object(p.a)(u.a.mark((function e(){var t,r,o,c,d,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=19;break}if(t=S,console.log("layerOps",a),console.log("layerOps[activeLayerName",a[n]),a[n]&&0!=a[n].length){r=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],o=Object(m.a)(a[n]);try{for(o.s();!(c=o.n()).done;)d=c.value,r=Be(r,d)}catch(u){o.e(u)}finally{o.f()}t=Be(r,S)}return ze((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(i.a)({},n,[].concat(Object(s.a)(e[n]||[]),[t])))})),p=[[[t[0][0],t[0][1],t[0][2],t[0][3]],[t[1][0],t[1][1],t[1][2],t[1][3]],[t[2][0],t[2][1],t[2][2],t[2][3]]],n],console.log("Data before sending",p),e.prev=8,e.next=11,fetch("".concat(ee,"/transform"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});case 11:console.log("Matrix sent to server:",p),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),console.error("Error submitting transform:",e.t0);case 17:e.next=20;break;case 19:console.log("No layer selected");case 20:case"end":return e.stop()}}),e,null,[[8,14]])})));return function(){return e.apply(this,arguments)}}()()}),[b,z,E,be,he,ve,F,H,V,ne,ce,de]);var Je=function(){var e=Object(p.a)(u.a.mark((function e(){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h(0),Y(0),P(0),me(0),xe(0),we(0),B(1),K(1),Q(1),re(!1),ie(!1),ue(!1),Se(r=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),Te(r),!n){e.next=31;break}return t(n,[]),o(n,[]),a=[[[1,0,0,0],[0,1,0,0],[0,0,1,0]],n],e.prev=19,e.next=22,fetch("".concat(ee,"/transform"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 22:return e.next=24,fetch("".concat(ee,"/reset_origin"),{method:"POST",headers:{"Content-Type":"application/json"}});case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(19),console.error("Failed to reset matrix on server:",e.t0);case 29:e.next=32;break;case 31:console.warn("Reset failed: no active layer selected.");case 32:case"end":return e.stop()}}),e,null,[[19,26]])})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=Object(p.a)(u.a.mark((function e(){var r,c,d,p,f,b;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&(null===(r=a[n])||void 0===r?void 0:r.length)&&(null===(c=Le[n])||void 0===c?void 0:c.length)){e.next=3;break}return console.warn("No transform to undo for layer:",n),e.abrupt("return",!1);case 3:return(d=Object(s.a)(a[n])).pop(),(p=Object(s.a)(Le[n])).pop(),console.log("HISTORY",p),f=p.length>0?p[p.length-1]:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],t(n,d),ze((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(i.a)({},n,p))})),console.log("COMPOSED",Le[n]),o(n,(function(e){return(null===e||void 0===e?void 0:e.length)?e.slice(0,-1):[]})),b=[[[f[0][0],f[0][1],f[0][2],f[0][3]],[f[1][0],f[1][1],f[1][2],f[1][3]],[f[2][0],f[2][1],f[2][2],f[2][3]]],n],e.prev=14,e.next=17,fetch("".concat(ee,"/transform"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)});case 17:return console.log("Undo successful. Sent:",b),e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(14),console.error("Undo failed:",e.t0),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,null,[[14,21]])})));return function(){return e.apply(this,arguments)}}(),He=function(){var e=Object(p.a)(u.a.mark((function e(){var r,a,c,i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=15;break}return t(n,_e),e.prev=2,e.next=5,fetch("".concat(ee,"/set_origin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error updating origin:",e.t0);case 10:for(a in r={translateX:b,translateY:z,translateZ:E,rotateX:be,rotateY:he,rotateZ:ve,scaleX:F,scaleY:H,scaleZ:V,reflectX:ne,reflectY:ce,reflectZ:de})c=r[a],i=a.startsWith("scale")?1:!a.startsWith("reflect")&&0,(a.startsWith("reflect")&&!0===c||!a.startsWith("reflect")&&c!==i)&&(s=De(a,c),console.log("Saving description:",s,"for",n),o(n,s));h(0),Y(0),P(0),me(0),xe(0),we(0),B(1),K(1),Q(1),re(!1),ie(!1),ue(!1),Se([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]),e.next=16;break;case 15:console.error("No layer selected.");case 16:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(){return e.apply(this,arguments)}}();return Object(g.jsxs)(y,{children:[Ee&&Object(g.jsxs)("p",{children:[Object(g.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.2em"},children:"Current Origin:"})," [",Ee.map((function(e){return e.toFixed(2)})).join(", "),"]"]}),Object(g.jsxs)(w,{children:[Object(g.jsx)(O,{children:"Translate in X, Y, or Z-axis"}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"X: "}),Object(g.jsx)(k,{type:"range",min:"-100",max:"100",step:"1",value:b,onChange:function(e){return Ue("translateX",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:b,onChange:function(e){return Ue("translateX",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Y: "}),Object(g.jsx)(k,{type:"range",min:"-100",max:"100",step:"1",value:z,onChange:function(e){return Ue("translateY",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:z,onChange:function(e){return Ue("translateY",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Z: "}),Object(g.jsx)(k,{type:"range",min:"-100",max:"100",step:"1",value:E,onChange:function(e){return Ue("translateZ",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:E,onChange:function(e){return Ue("translateZ",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]})]}),Object(g.jsxs)(w,{children:[Object(g.jsx)(O,{children:"Scale in X, Y, or Z-axis"}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"X: "}),Object(g.jsx)(k,{type:"range",min:"0.1",max:"2",step:"0.01",value:F,onChange:function(e){Ue("scaleX",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:F,onChange:function(e){Ue("scaleX",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Y: "}),Object(g.jsx)(k,{type:"range",min:"0.1",max:"2",step:"0.01",value:H,onChange:function(e){Ue("scaleY",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:H,onChange:function(e){Ue("scaleY",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Z: "}),Object(g.jsx)(k,{type:"range",min:"0.1",max:"2",step:"0.01",value:V,onChange:function(e){Ue("scaleZ",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:V,onChange:function(e){Ue("scaleZ",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]})]}),Object(g.jsxs)(w,{children:[Object(g.jsx)(O,{children:"Rotate about X, Y, or Z-axis in degrees"}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"X: "}),Object(g.jsx)(k,{type:"range",min:"-360",max:"360",step:"1",value:be,onChange:function(e){Ue("rotateX",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:be,onChange:function(e){Ue("rotateX",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Y: "}),Object(g.jsx)(k,{type:"range",min:"-360",max:"360",step:"1",value:he,onChange:function(e){Ue("rotateY",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:he,onChange:function(e){Ue("rotateY",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]}),Object(g.jsxs)(C,{children:[Object(g.jsx)(v,{children:"Z: "}),Object(g.jsx)(k,{type:"range",min:"-360",max:"360",step:"1",value:ve,onChange:function(e){Ue("rotateZ",e.target.value)},onMouseUp:He}),Object(g.jsx)(_,{value:ve,onChange:function(e){Ue("rotateZ",e.target.value)},onKeyDown:function(e){return"Enter"===e.key&&He()},type:"number"})]})]}),Object(g.jsxs)(w,{children:[Object(g.jsx)(O,{children:"Reflect on X, Y, or Z-axis"}),Object(g.jsxs)(N,{children:[Object(g.jsxs)(S,{children:[Object(g.jsx)(v,{children:"X: "}),Object(g.jsx)("input",{type:"checkbox",checked:ne,onChange:function(e){Ue("reflectX",e.target.checked),setTimeout(He,0)},onMouseUp:He})]}),Object(g.jsxs)(S,{children:[Object(g.jsx)(v,{children:"Y: "}),Object(g.jsx)("input",{type:"checkbox",checked:ce,onMouseUp:He,onChange:function(e){return Ue("reflectY",e.target.checked)}})]}),Object(g.jsxs)(S,{children:[Object(g.jsx)(v,{children:"Z: "}),Object(g.jsx)("input",{type:"checkbox",checked:de,onMouseUp:He,onChange:function(e){return Ue("reflectZ",e.target.checked)}})]})]})]}),Object(g.jsxs)(I,{children:[Object(g.jsx)(v,{children:"Transformation Matrix"}),Array.isArray(_e)&&Array.isArray(_e[0])&&Object(g.jsx)(M,{children:_e.flat().map((function(e,t){return Object(g.jsx)(T,{children:e%1===0?e:e.toFixed(2)},t)}))})]}),Object(g.jsxs)(x,{children:[Object(g.jsx)(A,{onClick:Je,children:"Reset"}),Object(g.jsx)(A,{onClick:qe,children:"Undo Last Transform"}),Object(g.jsx)(A,{onClick:function(){var e=JSON.stringify({matrix:_e},null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="transform_matrix.json",r.click(),URL.revokeObjectURL(n)},children:"Export Matrix"})]})]})}var x=b.a.div.withConfig({displayName:"TransformMenu__ButtonContainer",componentId:"sc-1fsdtvx-0"})(["display:flex;width:100%;justify-content:space-between;"]),y=(b.a.button.withConfig({displayName:"TransformMenu__UndoButton",componentId:"sc-1fsdtvx-1"})(["margin-top:1rem;padding:0.5rem 1rem;border:none;border-radius:0.5rem;font-size:0.9rem;cursor:pointer;background-color:#007bff;color:white;transition:background-color 0.3s;&:hover{background-color:#0056b3;}"]),b.a.div.withConfig({displayName:"TransformMenu__InputContainer",componentId:"sc-1fsdtvx-2"})(["display:flex;align-items:center;position:relative;width:fit-content;"]),b.a.div.withConfig({displayName:"TransformMenu__TransformContainer",componentId:"sc-1fsdtvx-3"})(["width:100%;display:flex;flex-direction:column;align-items:center;"])),O=b.a.h3.withConfig({displayName:"TransformMenu__SubtitleTransform",componentId:"sc-1fsdtvx-4"})(["margin-bottom:0px;font-size:12px;"]),v=b.a.h3.withConfig({displayName:"TransformMenu__Subtitle",componentId:"sc-1fsdtvx-5"})([""]),w=b.a.div.withConfig({displayName:"TransformMenu__SettingContainer",componentId:"sc-1fsdtvx-6"})(["width:calc(100% - 3rem);"]),C=b.a.div.withConfig({displayName:"TransformMenu__SliderContainer",componentId:"sc-1fsdtvx-7"})(["display:flex;width:100%;align-items:center;"]),k=b.a.input.withConfig({displayName:"TransformMenu__Slider",componentId:"sc-1fsdtvx-8"})(["flex:1;margin-left:0.5em;"]),_=b.a.input.withConfig({displayName:"TransformMenu__Input",componentId:"sc-1fsdtvx-9"})(["height:20px;width:35px;text-align:center;font-size:1.2em;font-weight:bold;margin-left:0.5em;"]),S=b.a.div.withConfig({displayName:"TransformMenu__ReflectAxisContainer",componentId:"sc-1fsdtvx-10"})(["display:flex;width:33%;justify-content:center;"]),N=b.a.div.withConfig({displayName:"TransformMenu__ReflectContainer",componentId:"sc-1fsdtvx-11"})(["display:flex;width:100%;align-items:center;justify-content:stretch;"]),I=b.a.div.withConfig({displayName:"TransformMenu__MatrixContainer",componentId:"sc-1fsdtvx-12"})(["display:flex;width:calc(100% - 3rem);justify-content:center;align-items:center;flex-direction:column;"]),M=b.a.div.withConfig({displayName:"TransformMenu__GridContainer",componentId:"sc-1fsdtvx-13"})(["display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(3,1fr);width:60%;"]),T=b.a.div.withConfig({displayName:"TransformMenu__GridCell",componentId:"sc-1fsdtvx-14"})(["border:1px solid black;display:flex;justify-content:center;align-items:center;font-size:12px;font-weight:bold;"]),A=b.a.button.withConfig({displayName:"TransformMenu__ResetButton",componentId:"sc-1fsdtvx-15"})(["margin-top:1rem;padding:0.5rem 1rem;border:none;border-radius:0.5rem;font-size:0.9rem;cursor:pointer;&:hover{background-color:rgb(137,137,137);}"]);function R(e){var t=e.activeLayerName,n=e.layerType;if(!t||!n)return Object(g.jsx)(X,{children:"No layer selected. Please select a layer to view rendering options."});switch(n){case"image":return Object(g.jsx)(L,{layerName:t});case"segmentation":return Object(g.jsx)(z,{layerName:t});case"mesh":return Object(g.jsx)(Y,{layerName:t});default:return Object(g.jsxs)(X,{children:["Unsupported layer type: ",n]})}}function L(e){var t=e.layerName,n=Object(r.useState)(1),a=Object(f.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)(0),l=Object(f.a)(i,2),d=l[0],b=l[1],m=Object(r.useState)(65535),j=Object(f.a)(m,2),h=j[0],x=j[1],y=Object(r.useState)("rgb"),O=Object(f.a)(y,2),v=O[0],w=O[1],C=Object(r.useState)(3),k=Object(f.a)(C,2),_=(k[0],k[1],Object(r.useState)(Array(3).fill(1))),S=Object(f.a)(_,2),N=S[0],I=S[1],M=function(e,t){var n=parseFloat(t);"opacity"===e&&c(n),"rangeMin"===e&&b(n),"rangeMax"===e&&x(n)},T=function(e,t){var n=Object(s.a)(N);n[e]=parseFloat(t),I(n)},A=function(e){w(e)};return Object(r.useEffect)((function(){if(t){var e="rgb"===v?"".concat(N.map((function(e,t){return"#uicontrol float gamma".concat(t," slider(min=0.1, max=5, step=0.01, default=").concat(N[t].toFixed(2),")")})).join("\n"),"\n#uicontrol invlerp normalized(range=[").concat(d,", ").concat(h,"])\nvoid main() {\n  float v = normalized();\n  vec3 rgb = vec3(0.0);\n").concat(N.map((function(e,t){return"  rgb += pow(vec3(v), vec3(gamma".concat(t,")) / ").concat(N.length.toFixed(1),";")})).join("\n"),"\n  emitRGB(rgb);\n}"):"#uicontrol invlerp normalized(range=[".concat(d,", ").concat(h,"])\nvoid main() {\n  emitGrayscale(normalized());\n}"),n={layerName:t,opacity:o,shader:e,shaderControls:{normalized:{range:[d,h]}}};(function(){var e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(ee,"/update_image_rendering"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 3:if(e.sent.ok){e.next=6;break}throw new Error("Server error");case 6:console.log("Image rendering updated:",n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to update rendering:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}})()()}}),[o,d,h,v,N]),Object(g.jsxs)(E,{children:[Object(g.jsxs)(P,{children:[Object(g.jsxs)(D,{children:["Image Rendering Controls for ",Object(g.jsx)("strong",{children:t})]}),Object(g.jsxs)(H,{children:[Object(g.jsx)(K,{selected:"rgb"===v,onClick:function(){return A("rgb")},children:"RGB"}),Object(g.jsx)(K,{selected:"greyscale"===v,onClick:function(){return A("greyscale")},children:"Greyscale"})]})]}),Object(g.jsx)(U,{children:"Opacity"}),Object(g.jsxs)(B,{children:[Object(g.jsx)(J,{type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:function(e){return M("opacity",e.target.value)}}),Object(g.jsx)(q,{type:"number",step:"0.01",value:o,onChange:function(e){return M("opacity",e.target.value)}})]}),Object(g.jsx)(U,{children:"Normalized Shader Range"}),Object(g.jsxs)(B,{children:[Object(g.jsx)(F,{children:"Min:"}),Object(g.jsx)(J,{type:"range",min:"0",max:h,step:"1",value:d,onChange:function(e){return M("rangeMin",e.target.value)}}),Object(g.jsx)(q,{type:"number",value:d,onChange:function(e){return M("rangeMin",e.target.value)}})]}),Object(g.jsxs)(B,{children:[Object(g.jsx)(F,{children:"Max:"}),Object(g.jsx)(J,{type:"range",min:d,max:"65535",step:"1",value:h,onChange:function(e){return M("rangeMax",e.target.value)}}),Object(g.jsx)(q,{type:"number",value:h,onChange:function(e){return M("rangeMax",e.target.value)}})]}),"rgb"===v&&Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(U,{children:"Gamma (Per Channel)"}),N.map((function(e,t){return Object(g.jsxs)(B,{children:[Object(g.jsxs)(F,{children:["Gamma ",t+1]}),Object(g.jsx)(J,{type:"range",min:"0.1",max:"5",step:"0.01",value:e,onChange:function(e){return T(t,e.target.value)}}),Object(g.jsx)(q,{type:"number",step:"0.01",value:e,onChange:function(e){return T(t,e.target.value)}})]},t)}))]})]})}function z(e){var t=e.layerName,n=Object(r.useState)(1),a=Object(f.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)(1),s=Object(f.a)(i,2),l=s[0],d=s[1],b=function(e,t){var n=parseFloat(t);"opacity"===e&&c(n),"saturation"===e&&d(n)};return Object(r.useEffect)((function(){c(1),d(1)}),[t]),Object(r.useEffect)((function(){(function(){var e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(ee,"/update_segment_rendering"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({layerName:t,opacity:o,saturation:l})});case 3:if(e.sent.ok){e.next=6;break}throw new Error("Server error");case 6:console.log("Segment rendering updated:",{layerName:t,opacity:o,saturation:l}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to update segment rendering:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}})()()}),[o,l]),Object(g.jsxs)(E,{children:[Object(g.jsxs)(D,{children:["Segment Rendering Controls for ",Object(g.jsx)("strong",{children:t})]}),Object(g.jsx)(U,{children:"Opacity"}),Object(g.jsxs)(B,{children:[Object(g.jsx)(J,{type:"range",min:"0",max:"1",step:"0.01",value:o,onChange:function(e){return b("opacity",e.target.value)}}),Object(g.jsx)(q,{type:"number",step:"0.01",value:o,onChange:function(e){return b("opacity",e.target.value)}})]}),Object(g.jsx)(U,{children:"Saturation"}),Object(g.jsxs)(B,{children:[Object(g.jsx)(J,{type:"range",min:"0",max:"1",step:"0.01",value:l,onChange:function(e){return b("saturation",e.target.value)}}),Object(g.jsx)(q,{type:"number",step:"0.01",value:l,onChange:function(e){return b("saturation",e.target.value)}})]})]})}function Y(e){var t=e.layerName;return Object(g.jsxs)(Z,{children:["Mesh Rendering Controls for ",Object(g.jsx)("strong",{children:t})]})}var X=b.a.p.withConfig({displayName:"RenderMenu__Message",componentId:"sc-1qfn6vh-0"})(["font-style:italic;font-size:0.9rem;"]),Z=b.a.div.withConfig({displayName:"RenderMenu__Section",componentId:"sc-1qfn6vh-1"})(["padding:1rem;font-size:0.9rem;"]),E=b.a.div.withConfig({displayName:"RenderMenu__SettingContainer",componentId:"sc-1qfn6vh-2"})(["width:calc(100% - 3rem);margin-top:1rem;"]),P=b.a.div.withConfig({displayName:"RenderMenu__SectionHeaderRow",componentId:"sc-1qfn6vh-3"})(["display:flex;justify-content:space-between;align-items:center;"]),D=b.a.h4.withConfig({displayName:"RenderMenu__SectionTitle",componentId:"sc-1qfn6vh-4"})(["font-size:0.95rem;"]),U=b.a.h3.withConfig({displayName:"RenderMenu__SubtitleTransform",componentId:"sc-1qfn6vh-5"})(["margin-top:1rem;margin-bottom:0px;font-size:12px;"]),F=b.a.h3.withConfig({displayName:"RenderMenu__Subtitle",componentId:"sc-1qfn6vh-6"})(["font-size:12px;width:40px;"]),B=b.a.div.withConfig({displayName:"RenderMenu__SliderContainer",componentId:"sc-1qfn6vh-7"})(["display:flex;width:100%;align-items:center;"]),J=b.a.input.withConfig({displayName:"RenderMenu__Slider",componentId:"sc-1qfn6vh-8"})(["flex:1;margin-left:0.5em;"]),q=b.a.input.withConfig({displayName:"RenderMenu__Input",componentId:"sc-1qfn6vh-9"})(["height:20px;width:50px;text-align:center;font-size:1em;margin-left:0.5em;"]),H=b.a.div.withConfig({displayName:"RenderMenu__ModeToggle",componentId:"sc-1qfn6vh-10"})(["display:flex;gap:0.5rem;"]),K=b.a.button.withConfig({displayName:"RenderMenu__ModeButton",componentId:"sc-1qfn6vh-11"})(["padding:0.4rem 1rem;border-radius:0.4rem;border:1px solid #ccc;background-color:",";color:",";font-weight:bold;cursor:pointer;transition:0.2s;"],(function(e){return e.selected?"#007bff":"#f0f0f0"}),(function(e){return e.selected?"white":"#333"}));function G(e){var t,n=e.saveLayerState,a=e.activeLayerName,o=e.activeLayerType,c=e.layerOps,i=e.trackTransforms,s=e.saveTrackTransforms,l=Object(r.useState)(0),d=Object(f.a)(l,2),u=d[0],p=d[1];switch(u){case 0:t=Object(g.jsx)(R,{activeLayerName:a,layerType:o});break;case 1:t=Object(g.jsx)(h,{saveLayerState:n,activeLayerName:a,layerOps:c,trackTransforms:i,saveTrackTransforms:s})}return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)(W,{children:[Object(g.jsx)(V,{onClick:function(){p(0)},selected:0==u,children:"Rendering"}),Object(g.jsx)(V,{onClick:function(){p(1)},selected:1==u,children:"Transform"}),Object(g.jsx)(V,{onClick:function(){p(2)},selected:2==u,children:"Processing"}),Object(g.jsx)(V,{onClick:function(){p(3)},selected:3==u,children:"Analysis"}),Object(g.jsx)(V,{onClick:function(){p(4)},selected:4==u,children:"Annotation"})]}),Object(g.jsx)(Q,{children:t})]})}var W=b.a.div.withConfig({displayName:"Menu__TabButtonContainer",componentId:"sc-1n0x83l-0"})(["margin-left:1rem;width:90%;display:flex;"]),V=b.a.button.withConfig({displayName:"Menu__TabButton",componentId:"sc-1n0x83l-1"})(["background-color:",";color:",";float:left;outline:none;cursor:pointer;padding:0.5rem 0.8rem;transition:0.3s;font-size:12px;font-weight:700;border-top:1px solid rgba(0,0,0,0.6);border-bottom:1px solid rgba(0,0,0,0.6);border-left:none;border-right:1px solid rgba(0,0,0,0.6);display:block;:first-child{border-radius:5px 0 0 5px;border-left:1px solid rgba(0,0,0,0.6);}:last-child{border-radius:0 5px 5px 0;border-right:1px solid rgba(0,0,0,0.6);}width:25%;"],(function(e){return e.selected?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)"}),(function(e){return e.selected?"white":"rgba(0, 0, 0, 0.9)"})),Q=b.a.div.withConfig({displayName:"Menu__TabContent",componentId:"sc-1n0x83l-2"})(["display:flex;flex-direction:column;padding:0.3rem;border-top:none;font-size:10px;margin-top:0.5rem;align-items:center;"]),$=n(50),ee="http://localhost:".concat("8085");var te=function(e){var t=e.trigger,n=e.menuItems,a=Object(r.useState)(!1),o=Object(f.a)(a,2),c=o[0],i=o[1];return Object(g.jsxs)(oe,{tabIndex:0,onBlur:function(e){setTimeout((function(){return i(!1)}),100)},children:[Object(g.jsx)(ce,{onClick:function(){return i((function(e){return!e}))},children:t}),c&&Object(g.jsx)(ie,{role:"menu",children:n.map((function(e,t){var n=e.label,r=e.onClick;return Object(g.jsx)(se,{role:"menuitem",children:Object(g.jsx)("button",{onClick:r,children:n})},t)}))})]})},ne=function(e){var t=e.data,n=e.activeLayer,a=e.setActiveLayer,o=(e.layerOps,e.trackTransforms),c=Object(r.useState)({}),s=Object(f.a)(c,2),d=s[0],b=s[1];Object(r.useEffect)((function(){t&&b((function(e){var n=Object(l.a)({},e);return t.forEach((function(t){var r=!1!==t.visible;e[t.name]!==r&&(n[t.name]=r)})),n}))}),[t]);var m=function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!d[t],b((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(i.a)({},t,n))})),e.prev=2,e.next=5,fetch("".concat(ee,"/toggle_visibility"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({layerName:t,visible:n})});case 5:console.log("Set ".concat(t," visibility to"),n),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.error("Error toggling layer visibility:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}();return console.log("trackTransforms in LayerList:",o),Object(g.jsx)("div",{children:t?t.map((function(e,t){return Object(g.jsxs)("div",{children:[Object(g.jsxs)(he,{isActive:(null===n||void 0===n?void 0:n.name)===e.name,onClick:function(){(null===n||void 0===n?void 0:n.name)===e.name?a(null):a(e)},children:[Object(g.jsx)("span",{children:e.name}),Object(g.jsx)("em",{children:e.type})]}),Object(g.jsxs)("div",{style:{position:"relative",width:"100%"},children:[Object(g.jsx)(re,{layerName:e.name,transformDescriptions:o[e.name]}),Object(g.jsx)("div",{style:{position:"absolute",top:0,right:0},children:Object(g.jsx)("button",{onClick:function(){return m(e.name)},style:{backgroundColor:d[e.name]?"#4CAF50":"#F44336",color:"white",border:"none",borderRadius:"20px",padding:"0.5rem 1rem",cursor:"pointer",fontSize:"0.9rem",transition:"background-color 0.3s, transform 0.2s",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},onMouseEnter:function(e){e.currentTarget.style.transform="scale(1.05)"},onMouseLeave:function(e){e.currentTarget.style.transform="scale(1)"},children:d[e.name]?"On":"Off"})})]})]},t)})):Object(g.jsx)(xe,{children:"Loading..."})})},re=function(e){var t=e.layerName,n=e.transformDescriptions,a=Object(r.useState)(!1),o=Object(f.a)(a,2),c=o[0],i=o[1];return console.log("Descriptions for",t,n),Object(g.jsxs)("div",{children:[Object(g.jsx)(fe,{onClick:function(){return i(!c)},children:c?"Hide":"Show Transforms"}),c&&(n&&n.length>0?Object(g.jsx)("ol",{style:{listStyleType:"decimal",paddingLeft:"1.5em",marginTop:"0.5em",fontSize:"0.5em"},children:n.map((function(e,t){return Object(g.jsx)("li",{style:{marginBottom:"0.5em"},children:e},t)}))}):Object(g.jsxs)("p",{style:{marginBottom:"0.3em",paddingLeft:"1.5em",fontSize:"0.5em"},children:["No transform descriptions saved for ",t]}))]})},ae=b.a.div.withConfig({displayName:"App__Main",componentId:"o524ye-0"})(["display:flex;flex-direction:column;height:100vh;overflow:auto;"]),oe=b.a.div.withConfig({displayName:"App__RibbonDropdownContainer",componentId:"o524ye-1"})(["position:relative;display:inline-block;outline:none;"]),ce=b.a.div.withConfig({displayName:"App__RibbonDropdownTrigger",componentId:"o524ye-2"})(["cursor:pointer;"]),ie=b.a.ul.withConfig({displayName:"App__RibbonDropdownMenu",componentId:"o524ye-3"})(["position:absolute;top:100%;left:0;list-style:none;background-color:white;opacity:1;border:1px solid #ccc;border-radius:5px;margin-top:0.3rem;padding:0.5rem 0;box-shadow:0 2px 5px rgba(0,0,0,0.15);z-index:999;width:max-content;white-space:nowrap;"]),se=b.a.li.withConfig({displayName:"App__DropdownItem",componentId:"o524ye-4"})(["padding:0.5rem 1rem;button{border:none;background:none;width:100%;text-align:left;font-size:0.9rem;cursor:pointer;&:hover{background-color:#f5f5f5;}}"]),le=b.a.span.withConfig({displayName:"App__LayerTitle",componentId:"o524ye-5"})(["font-size:0.8rem;font-weight:bold;"]),de=b.a.h1.withConfig({displayName:"App__DashboardText",componentId:"o524ye-6"})(["margin-left:20px;"]),ue=b.a.div.withConfig({displayName:"App__Ribbon",componentId:"o524ye-7"})(["display:flex;justify-content:flex-start;align-items:center;background-color:#f0f0f0;padding:0 20px;border-radius:5px;margin-bottom:20px;box-shadow:0 2px 5px rgba(0,0,0,0.1);max-width:1000px;"]),pe=b.a.button.withConfig({displayName:"App__RibbonButton",componentId:"o524ye-8"})(["background-color:transparent;color:#333;border:none;padding:10px 15px;font-size:14px;font-weight:500;cursor:pointer;transition:background-color 0.3s,color 0.3s;&:hover{background-color:#e0e0e0;color:#000;}"]),fe=(b.a.button.withConfig({displayName:"App__Button",componentId:"o524ye-9"})(["background-color:",";color:",";float:left;outline:none;cursor:pointer;padding:0.5rem 0.8rem;transition:0.3s;font-size:12px;font-weight:700;border-top:1px solid rgba(0,0,0,0.6);border-bottom:1px solid rgba(0,0,0,0.6);border-left:none;border-right:1px solid rgba(0,0,0,0.6);display:block;:first-child{border-radius:5px 0 0 5px;border-left:1px solid rgba(0,0,0,0.6);}:last-child{border-radius:0 5px 5px 0;border-right:1px solid rgba(0,0,0,0.6);}width:25%;"],(function(e){return e.selected?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.9)"}),(function(e){return e.selected?"white":"rgba(0, 0, 0, 0.9)"})),b.a.button.withConfig({displayName:"App__ShowTransformsButton",componentId:"o524ye-10"})(["margin-top:1rem;padding:0.5rem 1rem;border:none;border-radius:0.5rem;font-size:0.8rem;cursor:pointer;background-color:rgb(212,212,212);transition:background-color 0.3s;&:hover{background-color:rgb(200,200,200);}&:focus{outline:none;}"])),be=b.a.div.withConfig({displayName:"App__Container",componentId:"o524ye-11"})(["display:flex;width:100vw;height:100vh;"]),me=(b.a.div.withConfig({displayName:"App__LeftContent",componentId:"o524ye-12"})(["height:100%;width:calc(100% - 20rem);"]),b.a.div.withConfig({displayName:"App__MainContainer",componentId:"o524ye-13"})(["display:flex;position:relative;height:100%;"]),b.a.div.withConfig({displayName:"App__Header",componentId:"o524ye-14"})(["background-color:rgba(0,0,0,0.8);padding:0.5rem 0 0.5rem 0.5rem;"]),b.a.h1.withConfig({displayName:"App__HeaderText",componentId:"o524ye-15"})(["margin:0;margin-left:1rem;font-weight:700;font-size:1.4em;color:rgba(0,0,0,0.85);color:rgba(255,255,255,0.9);"]),b.a.h2.withConfig({displayName:"App__HeaderSmallText",componentId:"o524ye-16"})(["margin:0;margin-left:1rem;font-size:0.85em;font-weight:300;color:rgba(0,0,0,0.8);color:rgba(255,255,255,0.9);"]),b.a.div.withConfig({displayName:"App__LeftContainer",componentId:"o524ye-17"})(["display:flex;flex-direction:column;flex:1;font-size:30px;"]),b.a.div.withConfig({displayName:"App__RightContainer",componentId:"o524ye-18"})(["display:flex;width:25rem;flex-direction:column;border-radius:5px;font-size:30px;padding:2rem 1rem 1rem 1rem;"])),je=b.a.h3.withConfig({displayName:"App__PanelHeader",componentId:"o524ye-19"})(["margin-bottom:1.5rem;font-size:1.25rem;font-weight:600;color:#333;border-bottom:1px solid #ddd;padding-bottom:0.5rem;"]),ge=(b.a.div.withConfig({displayName:"App__WhiteContainer",componentId:"o524ye-20"})(["display:flex;height:50%;background-color:#ffffff;overflow:auto;padding-bottom:1rem;"]),b.a.div.withConfig({displayName:"App__TreeControl",componentId:"o524ye-21"})(["display:flex;flex-direction:column;flex-shrink:1;border:1px solid;text-align:center;padding:0.5rem;"]),b.a.button.withConfig({displayName:"App__TreeControlButton",componentId:"o524ye-22"})(["margin:0.5rem;width:4rem;"]),b.a.div.withConfig({displayName:"App__Folders",componentId:"o524ye-23"})(["text-align:left;flex:3;padding:0.5rem;overflow:auto;"]),b.a.div.withConfig({displayName:"App__SomaContainer",componentId:"o524ye-24"})(["display:flex;flex-shrink:1;background-color:#ffffff;overflow:auto;"]),b.a.div.withConfig({displayName:"App__HeaderRow",componentId:"o524ye-25"})(["display:grid;grid-template-columns:1fr 1fr;font-weight:bold;padding:0.75rem 1rem;border-bottom:2px solid #ccc;"])),he=b.a.button.withConfig({displayName:"App__LayerButton",componentId:"o524ye-26"})(["display:grid;width:100%;grid-template-columns:1fr 1fr;align-items:center;background-color:",";border:1px solid ",";border-radius:6px;padding:0.75rem 1rem;font-size:1rem;margin-top:0.8rem;cursor:pointer;transition:background-color 0.2s ease,box-shadow 0.2s ease;text-align:left;&:hover{box-shadow:0 0 0 2px rgba(0,123,255,0.15);}span{font-weight:500;font-size:0.9rem;}em{font-size:0.9rem;color:#666;font-style:normal;}"],(function(e){return e.isActive?"#e6f7ff":"#fff"}),(function(e){return e.isActive?"#1890ff":"#ddd"})),xe=b.a.p.withConfig({displayName:"App__LoadingText",componentId:"o524ye-27"})(["font-size:1rem;color:#888;font-style:italic;"]),ye=function(){var e=Object(r.useState)(null),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(!1),c=Object(f.a)(o,2),d=(c[0],c[1]),b=Object(r.useState)(null),m=Object(f.a)(b,2),h=(m[0],m[1]),x=Object(r.useRef)(null),y=Object(r.useState)(null),O=Object(f.a)(y,2),v=O[0],w=O[1],C=Object(r.useState)({}),k=Object(f.a)(C,2),_=k[0],S=k[1],N=Object(r.useState)({}),I=Object(f.a)(N,2),M=I[0],T=I[1],A=Object(r.useRef)(null),R=Object(r.useRef)(null);return Object(r.useEffect)((function(){x.current||(x.current=Object($.io)(ee,{path:"/socket.io/",transports:["polling"],reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3,timeout:2e4,autoConnect:!0,extraHeaders:{Origin:window.location.origin},withCredentials:!0}),x.current.on("connect",(function(){console.log("Socket.IO connected successfully with ID:",x.current.id),d(!0),h(null)})),x.current.on("connection_established",(function(e){console.log("Server confirmed connection:",e)})),x.current.on("connect_error",(function(e){console.error("Socket.IO connection error:",e),d(!1),h("Connection error: ".concat(e.message))})),x.current.on("disconnect",(function(e){console.log("Socket disconnected:",e),d(!1),h("Disconnected: ".concat(e))})));var e=function(){var e=Object(p.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Fetching layers from:","".concat(ee,"/layers")),e.next=4,fetch("".concat(ee,"/layers"),{credentials:"include",headers:{Accept:"application/json",Origin:window.location.origin}});case 4:return t=e.sent,e.next=7,t.json();case 7:n=e.sent,console.log("Fetched JSON:",n),a(n),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("Error fetching layers:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}();return e(),x.current&&x.current.on("layers-updated",(function(t){if(null===t||void 0===t?void 0:t.layers){var n=Object.entries(t.layers).map((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];return{name:n,type:r.type,visible:!1!==r.visible}}));a(n)}else e()})),function(){x.current&&(x.current.off("layers-updated"),x.current.off("connect"),x.current.off("disconnect"),x.current.off("connect_error"),x.current.off("connection_established"))}}),[]),Object(g.jsx)(j.Provider,{value:x,children:Object(g.jsxs)(ae,{children:[Object(g.jsx)(de,{children:"Dashboard"}),Object(g.jsx)("label",{htmlFor:"jsonUploadInput",style:{display:"none"}}),Object(g.jsx)("input",{id:"jsonUploadInput",type:"file",accept:".json",ref:A,style:{display:"none"},onClick:function(){A.current.value=null},onChange:function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(){var e=Object(p.a)(u.a.mark((function e(n){var r,a,o,c,i,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=n.target.result,a=JSON.parse(r),"layer"!==R.current){e.next=18;break}if(a.type){e.next=7;break}return alert("Invalid layer JSON: missing 'type' field."),e.abrupt("return");case 7:return(o=new FormData).append("file",t),o.append("layer_name",t.name.replace(".json","")),e.next=12,fetch("".concat(ee,"/import_layer"),{method:"POST",body:o});case 12:return c=e.sent,e.next=15,c.json();case 15:e.sent,e.next=30;break;case 18:if("viewer"!==R.current){e.next=30;break}if(a.layers){e.next=22;break}return alert("Invalid viewer state JSON: missing 'layers' field."),e.abrupt("return");case 22:return(i=new FormData).append("file",t),e.next=26,fetch("".concat(ee,"/import_viewer"),{method:"POST",body:i});case 26:return s=e.sent,e.next=29,s.json();case 29:e.sent;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(0),alert("Failed to read or upload JSON: "+e.t0.message);case 35:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(t){return e.apply(this,arguments)}}(),n.readAsText(t)}}}),Object(g.jsxs)(ue,{children:[Object(g.jsx)(te,{trigger:Object(g.jsx)(pe,{children:"File"}),menuItems:[{label:"Import Layer",onClick:function(){var e;console.log("Triggering file input for layer import"),R.current="layer",console.log("Attempting to click:",A.current),console.log("Is in DOM?",document.body.contains(A.current)),null===(e=A.current)||void 0===e||e.click()}},{label:"Import Viewer State",onClick:function(){var e;console.log("Triggering file input for viewer import"),R.current="viewer",console.log("Attempting to click:",A.current),console.log("Is in DOM?",document.body.contains(A.current)),null===(e=A.current)||void 0===e||e.click()}},{label:"Export Layer",onClick:function(){console.log("Export Layer clicked")}}]}),Object(g.jsx)(te,{trigger:Object(g.jsx)(pe,{children:"Edit"}),menuItems:[{label:"Undo",onClick:function(){console.log("Undo clicked")}},{label:"Redo",onClick:function(){console.log("Redo clicked")}}]}),Object(g.jsx)(te,{trigger:Object(g.jsx)(pe,{children:"Plug-Ins"}),menuItems:[{label:"Load Plugin A",onClick:function(){console.log("Load Plugin A clicked")}},{label:"Load Plugin B",onClick:function(){console.log("Load Plugin B clicked")}}]})]}),Object(g.jsxs)(be,{children:[Object(g.jsxs)(me,{children:[Object(g.jsx)(je,{children:"Neuroglancer Layers"}),Object(g.jsxs)(ge,{children:[Object(g.jsx)(le,{children:"Name"}),Object(g.jsx)(le,{children:"Layer Type"})]}),Object(g.jsx)(ne,{data:n,activeLayer:v,setActiveLayer:w,layerOps:_,trackTransforms:M})]}),Object(g.jsx)(me,{children:Object(g.jsx)(G,{saveLayerState:function(e,t){S((function(n){return Object(l.a)(Object(l.a)({},n),{},Object(i.a)({},e,n[e]?[].concat(Object(s.a)(n[e]),[t]):[t]))})),console.log("Layer state saved:",e,t)},activeLayerName:null===v||void 0===v?void 0:v.name,activeLayerType:null===v||void 0===v?void 0:v.type,layerOps:_,saveTrackTransforms:function(e,t){T((function(n){var r=n[e]||[],a="function"===typeof t?t(r):Array.isArray(t)?t:[].concat(Object(s.a)(r),[t]);return Object(l.a)(Object(l.a)({},n),{},Object(i.a)({},e,a))}))}})})]})]})})};c.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(ye,{})}),document.getElementById("root"))}},[[89,1,2]]]);
//# sourceMappingURL=main.a3e02b9d.chunk.js.map