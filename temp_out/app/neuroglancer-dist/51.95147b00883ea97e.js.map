{"version":3,"file":"51.95147b00883ea97e.js","sources":["webpack://neuroglancer/./src/credentials_provider/http_request.ts","webpack://neuroglancer/./src/credentials_provider/oauth2.ts","webpack://neuroglancer/./src/credentials_provider/shared_common.ts","webpack://neuroglancer/./src/datasource/boss/base.ts","webpack://neuroglancer/./src/datasource/brainmaps/base.ts","webpack://neuroglancer/./src/datasource/deepzoom/base.ts","webpack://neuroglancer/./src/datasource/dvid/base.ts","webpack://neuroglancer/./src/datasource/n5/base.ts","webpack://neuroglancer/./src/datasource/nifti/base.ts","webpack://neuroglancer/./src/datasource/precomputed/base.ts","webpack://neuroglancer/./src/datasource/render/base.ts","webpack://neuroglancer/./src/datasource/zarr/base.ts","webpack://neuroglancer/./src/datasource/zarr/codec/index.ts","webpack://neuroglancer/./src/datasource/zarr/metadata/index.ts","webpack://neuroglancer/./src/gpu_hash/hash_function.ts","webpack://neuroglancer/./src/kvstore/byte_range/index.ts","webpack://neuroglancer/./src/kvstore/byte_range/register.ts","webpack://neuroglancer/./src/kvstore/context.ts","webpack://neuroglancer/./src/kvstore/gcs/index.ts","webpack://neuroglancer/./src/kvstore/gcs/register.ts","webpack://neuroglancer/./src/kvstore/gzip/file_handle.ts","webpack://neuroglancer/./src/kvstore/gzip/index.ts","webpack://neuroglancer/./src/kvstore/gzip/register.ts","webpack://neuroglancer/./src/kvstore/http/common.ts","webpack://neuroglancer/./src/kvstore/middleauth/common.ts","webpack://neuroglancer/./src/kvstore/ngauth/register.ts","webpack://neuroglancer/./src/kvstore/ocdbt/url.ts","webpack://neuroglancer/./src/kvstore/register.ts","webpack://neuroglancer/./src/kvstore/s3/common.ts","webpack://neuroglancer/./src/kvstore/shared_common.ts","webpack://neuroglancer/./src/mesh/base.ts","webpack://neuroglancer/./src/perspective_view/base.ts","webpack://neuroglancer/./src/render_layer_common.ts","webpack://neuroglancer/./src/single_mesh/base.ts","webpack://neuroglancer/./src/skeleton/base.ts","webpack://neuroglancer/./src/sliceview/chunk_layout.ts","webpack://neuroglancer/./src/util/animation_frame_debounce.ts","webpack://neuroglancer/./src/util/disjoint_sets.ts","webpack://neuroglancer/./src/util/false.ts","webpack://neuroglancer/./src/util/float32_to_string.ts","webpack://neuroglancer/./src/util/http_request.ts","webpack://neuroglancer/./src/util/linked_list.ts","webpack://neuroglancer/./src/util/memoize.ts","webpack://neuroglancer/./src/util/string.ts","webpack://neuroglancer/./src/util/trackable_enum.ts","webpack://neuroglancer/./src/util/trackable_screenshot_mode.ts","webpack://neuroglancer/./src/webgl/context.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  CredentialsProvider,\n  CredentialsWithGeneration,\n} from \"#src/credentials_provider/index.js\";\nimport type { FetchOk } from \"#src/util/http_request.js\";\nimport { fetchOk, HttpError, pickDelay } from \"#src/util/http_request.js\";\nimport type { ProgressListener } from \"#src/util/progress_listener.js\";\n\nconst maxCredentialsAttempts = 3;\n\nexport async function fetchOkWithCredentials<Credentials>(\n  credentialsProvider: CredentialsProvider<Credentials>,\n  input: RequestInfo | ((credentials: Credentials) => RequestInfo),\n  init: RequestInit & { progressListener?: ProgressListener },\n  applyCredentials: (\n    credentials: Credentials,\n    requestInit: RequestInit & { progressListener?: ProgressListener },\n  ) => RequestInit & { progressListener?: ProgressListener },\n  errorHandler: (httpError: HttpError, credentials: Credentials) => \"refresh\",\n): Promise<Response> {\n  let credentials: CredentialsWithGeneration<Credentials> | undefined;\n  for (let credentialsAttempt = 0; ; ) {\n    init.signal?.throwIfAborted();\n    if (credentialsAttempt > 1) {\n      // Don't delay on the first attempt, and also don't delay on the second attempt, since if the\n      // credentials have expired and there is no problem on the server there is no reason to delay\n      // requesting new credentials.\n      await new Promise((resolve) =>\n        setTimeout(resolve, pickDelay(credentialsAttempt - 2)),\n      );\n    }\n    credentials = await credentialsProvider.get(credentials, {\n      signal: init.signal ?? undefined,\n      progressListener: init.progressListener,\n    });\n    try {\n      return await fetchOk(\n        typeof input === \"function\" ? input(credentials.credentials) : input,\n        applyCredentials(credentials.credentials, init),\n      );\n    } catch (error) {\n      if (error instanceof HttpError) {\n        if (errorHandler(error, credentials.credentials) === \"refresh\") {\n          if (++credentialsAttempt === maxCredentialsAttempts) throw error;\n          continue;\n        }\n      }\n      throw error;\n    }\n  }\n}\n\nexport function fetchOkWithCredentialsAdapter<Credentials>(\n  credentialsProvider: CredentialsProvider<Credentials>,\n  applyCredentials: (\n    credentials: Credentials,\n    requestInit: RequestInit & { progressListener?: ProgressListener },\n  ) => RequestInit & { progressListener?: ProgressListener },\n  errorHandler: (httpError: HttpError, credentials: Credentials) => \"refresh\",\n): FetchOk {\n  return (input, init = {}) =>\n    fetchOkWithCredentials(\n      credentialsProvider,\n      input,\n      init,\n      applyCredentials,\n      errorHandler,\n    );\n}\n","/**\n * @license\n * Copyright 2020 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  fetchOkWithCredentials,\n  fetchOkWithCredentialsAdapter,\n} from \"#src/credentials_provider/http_request.js\";\nimport type { CredentialsProvider } from \"#src/credentials_provider/index.js\";\nimport type { FetchOk, HttpError } from \"#src/util/http_request.js\";\nimport { fetchOk } from \"#src/util/http_request.js\";\n\n/**\n * OAuth2 token\n */\nexport interface OAuth2Credentials {\n  tokenType: string;\n  accessToken: string;\n  email?: string;\n}\n\nfunction applyCredentials(\n  credentials: OAuth2Credentials,\n  init: RequestInit,\n): RequestInit {\n  if (!credentials.accessToken) return init;\n  const headers = new Headers(init.headers);\n  headers.set(\n    \"Authorization\",\n    `${credentials.tokenType} ${credentials.accessToken}`,\n  );\n  return { ...init, headers };\n}\n\nfunction errorHandler(\n  error: HttpError,\n  credentials: OAuth2Credentials,\n): \"refresh\" {\n  const { status } = error;\n  if (status === 401) {\n    // 401: Authorization needed.  OAuth2 token may have expired.\n    return \"refresh\";\n  }\n  if (status === 403 && !credentials.accessToken) {\n    // Anonymous access denied.  Request credentials.\n    return \"refresh\";\n  }\n  if (error instanceof Error && credentials.email !== undefined) {\n    error.message += `  (Using credentials for ${JSON.stringify(\n      credentials.email,\n    )})`;\n  }\n  throw error;\n}\n\nexport function fetchOkWithOAuth2Credentials(\n  credentialsProvider: CredentialsProvider<OAuth2Credentials> | undefined,\n  input: RequestInfo,\n  init: RequestInit,\n): Promise<Response> {\n  if (credentialsProvider === undefined) {\n    return fetchOk(input, init);\n  }\n  return fetchOkWithCredentials(\n    credentialsProvider,\n    input,\n    init,\n    applyCredentials,\n    errorHandler,\n  );\n}\n\nexport function fetchOkWithOAuth2CredentialsAdapter(\n  credentialsProvider: CredentialsProvider<OAuth2Credentials> | undefined,\n): FetchOk {\n  if (credentialsProvider === undefined) return fetchOk;\n  return fetchOkWithCredentialsAdapter(\n    credentialsProvider,\n    applyCredentials,\n    errorHandler,\n  );\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const CREDENTIALS_PROVIDER_RPC_ID = \"CredentialsProvider\";\nexport const CREDENTIALS_PROVIDER_GET_RPC_ID = \"CredentialsProvider.get\";\nexport const CREDENTIALS_MANAGER_RPC_ID = \"CredentialsManager\";\nexport const CREDENTIALS_MANAGER_GET_RPC_ID = \"CredentialsManager.get\";\n","/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { vec2 } from \"#src/util/geom.js\";\n\nexport class BossSourceParameters {\n  baseUrl: string;\n  collection: string;\n  experiment: string;\n  channel: string;\n  resolution: string;\n}\n\nexport class VolumeChunkSourceParameters extends BossSourceParameters {\n  encoding: string;\n  window: vec2 | undefined;\n\n  static RPC_ID = \"boss/VolumeChunkSource\";\n\n  static stringify(parameters: VolumeChunkSourceParameters) {\n    return `boss:volume:${parameters.baseUrl}/${parameters.collection}/${parameters.experiment}/${parameters.channel}/${parameters.resolution}/${parameters.encoding}`;\n  }\n}\n\nexport class MeshSourceParameters {\n  baseUrl: string;\n\n  static RPC_ID = \"boss/MeshChunkSource\";\n\n  static stringify(parameters: MeshSourceParameters) {\n    return `boss:mesh:${parameters.baseUrl}`;\n  }\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BrainmapsInstance } from \"#src/datasource/brainmaps/api.js\";\nimport type { vec3 } from \"#src/util/geom.js\";\n\nexport enum VolumeChunkEncoding {\n  RAW = 0,\n  JPEG = 1,\n  COMPRESSED_SEGMENTATION = 2,\n}\n\nexport class ChangeSpec {\n  changeStackId: string;\n  /**\n   * Apply changes prior to this timestamp (in milliseconds since epoch).  If 0, no changes should\n   * be applied.  If negative, all changes should be applied.\n   */\n  timeStamp?: number;\n  skipEquivalences?: boolean;\n}\n\nexport class VolumeSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  scaleIndex: number;\n  encoding: VolumeChunkEncoding;\n  jpegQuality: number | undefined;\n  changeSpec: ChangeSpec | undefined;\n\n  static RPC_ID = \"brainmaps/VolumeChunkSource\";\n}\n\nexport interface SingleMeshInfo {\n  name: string;\n  type: string;\n}\n\nexport interface MultiscaleMeshLOD {\n  info: SingleMeshInfo;\n  scale: number;\n\n  /**\n   * Shape of the chunk for this level of detail, as a multiple of the base chunk shape.\n   */\n  relativeBlockShape: vec3;\n\n  /**\n   * Size of chunk grid, in chunks.\n   */\n  gridShape: Uint32Array;\n}\n\nexport interface MultiscaleMeshInfo {\n  /**\n   * Prefix\n   */\n  key: string;\n\n  /**\n   * Chunk shape in spatial units (nm) for lod 0.\n   */\n  chunkShape: vec3;\n\n  lods: MultiscaleMeshLOD[];\n}\n\nexport class MultiscaleMeshSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  info: MultiscaleMeshInfo;\n  changeSpec: ChangeSpec | undefined;\n\n  static RPC_ID = \"brainmaps/MultiscaleMeshSource\";\n}\n\nexport class MeshSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  meshName: string;\n  changeSpec: ChangeSpec | undefined;\n\n  static RPC_ID = \"brainmaps/MeshSource\";\n}\n\nexport class SkeletonSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  meshName: string;\n  changeSpec: ChangeSpec | undefined;\n\n  static RPC_ID = \"brainmaps/SkeletonSource\";\n}\n\nexport class AnnotationSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  changestack: string;\n  upperVoxelBound: Float32Array;\n\n  static RPC_ID = \"brainmaps/Annotation\";\n}\n\nexport class AnnotationSpatialIndexSourceParameters {\n  instance: BrainmapsInstance;\n  volumeId: string;\n  changestack: string;\n\n  static RPC_ID = \"brainmaps/AnnotationSpatialIndex\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc., 2023 Gergely Csucs\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum ImageTileEncoding {\n  JPG = 0,\n  JPEG = 1,\n  PNG = 2,\n}\n\nexport class ImageTileSourceParameters {\n  url: string;\n  encoding: ImageTileEncoding;\n  format: string;\n  tilesize: number;\n  overlap: number;\n\n  static RPC_ID = \"deepzoom/ImageTileSource\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum VolumeChunkEncoding {\n  JPEG = 0,\n  RAW = 1,\n  COMPRESSED_SEGMENTATION = 2,\n  COMPRESSED_SEGMENTATIONARRAY = 3,\n}\n\nexport class DVIDSourceParameters {\n  baseUrl: string;\n  nodeKey: string;\n  dataInstanceKey: string;\n  authServer?: string;\n  user?: string;\n}\n\nexport class VolumeChunkSourceParameters extends DVIDSourceParameters {\n  dataScale: string;\n  encoding: VolumeChunkEncoding;\n  static RPC_ID = \"dvid/VolumeChunkSource\";\n}\n\nexport class SkeletonSourceParameters extends DVIDSourceParameters {\n  static RPC_ID = \"dvid/SkeletonSource\";\n}\n\nexport class MeshSourceParameters extends DVIDSourceParameters {\n  static RPC_ID = \"dvid/MeshSource\";\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum VolumeChunkEncoding {\n  RAW,\n  ZLIB,\n  GZIP,\n  BLOSC,\n  ZSTD,\n}\n\nexport class VolumeChunkSourceParameters {\n  url: string;\n  encoding: VolumeChunkEncoding;\n\n  static RPC_ID = \"n5/VolumeChunkSource\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DataType } from \"#src/sliceview/volume/base.js\";\n\nexport const GET_NIFTI_VOLUME_INFO_RPC_ID = \"nifti/getNiftiVolumeInfo\";\n\nexport interface NiftiVolumeInfo {\n  rank: number;\n  sourceNames: string[];\n  viewNames: string[];\n  viewScales: Float64Array;\n  sourceScales: Float64Array;\n  units: string[];\n  dataType: DataType;\n  transform: Float64Array;\n  description: string;\n  volumeSize: Uint32Array;\n}\n\nexport class VolumeSourceParameters {\n  url: string;\n\n  static RPC_ID = \"nifti/VolumeChunkSource\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  AnnotationPropertySpec,\n  AnnotationType,\n} from \"#src/annotation/index.js\";\nimport type { VertexAttributeInfo } from \"#src/skeleton/base.js\";\nimport type { mat4 } from \"#src/util/geom.js\";\n\nexport enum VolumeChunkEncoding {\n  RAW = 0,\n  JPEG = 1,\n  COMPRESSED_SEGMENTATION = 2,\n  COMPRESSO = 3,\n  PNG = 4,\n  JXL = 5,\n}\n\nexport class VolumeChunkSourceParameters {\n  url: string;\n  encoding: VolumeChunkEncoding;\n  sharding: ShardingParameters | undefined;\n\n  static RPC_ID = \"precomputed/VolumeChunkSource\";\n}\n\nexport class MeshSourceParameters {\n  url: string;\n  lod: number;\n\n  static RPC_ID = \"precomputed/MeshSource\";\n}\n\nexport enum DataEncoding {\n  RAW = 0,\n  GZIP = 1,\n}\n\nexport enum ShardingHashFunction {\n  IDENTITY = 0,\n  MURMURHASH3_X86_128 = 1,\n}\n\nexport interface ShardingParameters {\n  hash: ShardingHashFunction;\n  preshiftBits: number;\n  minishardBits: number;\n  shardBits: number;\n  minishardIndexEncoding: DataEncoding;\n  dataEncoding: DataEncoding;\n}\n\nexport class MultiscaleMeshMetadata {\n  transform: mat4;\n  lodScaleMultiplier: number;\n  vertexQuantizationBits: number;\n  sharding: ShardingParameters | undefined;\n}\n\nexport class MultiscaleMeshSourceParameters {\n  url: string;\n  metadata: MultiscaleMeshMetadata;\n\n  static RPC_ID = \"precomputed/MultiscaleMeshSource\";\n}\n\nexport interface SkeletonMetadata {\n  transform: mat4;\n  vertexAttributes: Map<string, VertexAttributeInfo>;\n  sharding: ShardingParameters | undefined;\n}\n\nexport class SkeletonSourceParameters {\n  url: string;\n  metadata: SkeletonMetadata;\n\n  static RPC_ID = \"precomputed/SkeletonSource\";\n}\n\nexport class AnnotationSpatialIndexSourceParameters {\n  url: string;\n  sharding: ShardingParameters | undefined;\n  static RPC_ID = \"precomputed/AnnotationSpatialIndexSource\";\n}\n\nexport class AnnotationSourceParameters {\n  rank: number;\n  relationships: {\n    url: string;\n    name: string;\n    sharding: ShardingParameters | undefined;\n  }[];\n  properties: AnnotationPropertySpec[];\n  byId: { url: string; sharding: ShardingParameters | undefined };\n  type: AnnotationType;\n  static RPC_ID = \"precomputed/AnnotationSource\";\n}\n\nexport class IndexedSegmentPropertySourceParameters {\n  url: string;\n  sharding: ShardingParameters | undefined;\n  static RPC_ID = \"precomputed/IndexedSegmentPropertySource\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class RenderBaseSourceParameters {\n  baseUrl: string;\n  owner: string;\n  project: string;\n  stack: string;\n  channel: string | undefined;\n}\n\nexport class RenderSourceParameters extends RenderBaseSourceParameters {\n  renderArgs: { [index: string]: string };\n}\n\nexport class TileChunkSourceParameters extends RenderSourceParameters {\n  dims: string;\n  level: number;\n  encoding: string;\n\n  static RPC_ID = \"render/TileChunkSource\";\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ArrayMetadata } from \"#src/datasource/zarr/metadata/index.js\";\n\nexport class VolumeChunkSourceParameters {\n  url: string;\n  metadata: ArrayMetadata;\n  static RPC_ID = \"zarr/VolumeChunkSource\";\n}\n","/**\n * @license\n * Copyright 2023 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DataType } from \"#src/util/data_type.js\";\n\nexport enum CodecKind {\n  arrayToArray = 0,\n  arrayToBytes = 1,\n  bytesToBytes = 2,\n}\n\nexport interface CodecSpec<Kind extends CodecKind = CodecKind> {\n  kind: Kind;\n  name: string;\n  configuration: unknown;\n}\n\nexport interface CodecChainSpec {\n  [CodecKind.arrayToArray]: CodecSpec<CodecKind.arrayToArray>[];\n  [CodecKind.arrayToBytes]: CodecSpec<CodecKind.arrayToBytes>;\n  [CodecKind.bytesToBytes]: CodecSpec<CodecKind.bytesToBytes>[];\n  arrayInfo: CodecArrayInfo[];\n  layoutInfo: CodecArrayLayoutInfo[];\n  shardingInfo?: ShardingInfo;\n  encodedSize: (number | undefined)[];\n}\n\nexport interface ShardingInfo {\n  subChunkShape: number[];\n  subChunkGridShape: number[];\n  subChunkCodecs: CodecChainSpec;\n}\n\nexport interface CodecArrayInfo {\n  dataType: DataType;\n  // Specifies the chunk shape, indexed by logical dimension.\n  chunkShape: number[];\n}\n\nexport interface CodecArrayLayoutInfo {\n  // Maps the physical dimension index of the array (assuming C order storage) to the logical\n  // dimension of the (transformed) array.\n  //\n  // `physicalToLogicalDimension[0]` is the logical dimension index of the outer-most (largest\n  // stride) dimension.\n  //\n  // `physicalToLogicalDimension[physicalToLogicalDimension.length-1]` is the logical dimension\n  // index of the inner-most (unit stride) dimension.\n  physicalToLogicalDimension: number[];\n\n  // Specifies the read chunk shape, indexed by logical dimension.\n  readChunkShape: number[];\n}\n","/**\n * @license\n * Copyright 2023 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CodecChainSpec } from \"#src/datasource/zarr/codec/index.js\";\nimport type { DataType } from \"#src/util/data_type.js\";\n\nexport enum ChunkKeyEncoding {\n  DEFAULT = 0,\n  V2 = 1,\n}\n\nexport type DimensionSeparator = \"/\" | \".\";\n\nexport type NodeType = \"array\" | \"group\";\n\nexport interface ArrayMetadata {\n  zarrVersion: 2 | 3;\n  nodeType: \"array\";\n  rank: number;\n  shape: number[];\n  chunkShape: number[];\n  dataType: DataType;\n  fillValue: number | bigint;\n  dimensionNames: (string | null)[];\n  dimensionUnits: (string | null)[];\n  userAttributes: Record<string, unknown>;\n  dimensionSeparator: DimensionSeparator;\n  chunkKeyEncoding: ChunkKeyEncoding;\n  codecs: CodecChainSpec;\n}\n\nexport interface GroupMetadata {\n  zarrVersion: 2 | 3;\n  nodeType: \"group\";\n  userAttributes: Record<string, unknown>;\n}\n\nexport type Metadata = ArrayMetadata | GroupMetadata;\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst k1 = 0xcc9e2d51;\nconst k2 = 0x1b873593;\n\n// MurmurHash excluding the final mixing steps.\nexport function hashCombine(state: number, value: number) {\n  value >>>= 0;\n  state >>>= 0;\n\n  value = Math.imul(value, k1) >>> 0;\n  value = ((value << 15) | (value >>> 17)) >>> 0;\n  value = Math.imul(value, k2) >>> 0;\n  state = (state ^ value) >>> 0;\n  state = ((state << 13) | (state >>> 19)) >>> 0;\n  state = (state * 5 + 0xe6546b64) >>> 0;\n  return state;\n}\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FileByteRangeHandle } from \"#src/kvstore/byte_range/file_handle.js\";\nimport type {\n  DriverReadOptions,\n  KvStore,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n  FileHandle,\n  ByteRange,\n} from \"#src/kvstore/index.js\";\n\nfunction parseKey(key: string): ByteRange {\n  const m = key.match(/^([0-9]+)-([0-9]+)$/);\n  if (m !== null) {\n    const begin = Number(m[1]);\n    const end = Number(m[2]);\n    if (end >= begin) {\n      return { offset: begin, length: end - begin };\n    }\n  }\n  throw new Error(\n    `Invalid key ${JSON.stringify(key)} for \"byte-range:\", expected \"<begin>-<end>\"`,\n  );\n}\n\nexport class ByteRangeKvStore implements KvStore {\n  constructor(public base: FileHandle) {}\n\n  getUrl(key: string) {\n    return this.base.getUrl() + `|byte-range:${key}`;\n  }\n\n  async stat(\n    key: string,\n    options: StatOptions,\n  ): Promise<StatResponse | undefined> {\n    const { length } = parseKey(key);\n    options;\n    return { totalSize: length };\n  }\n\n  async read(\n    key: string,\n    options: DriverReadOptions,\n  ): Promise<ReadResponse | undefined> {\n    const byteRange = parseKey(key);\n    return new FileByteRangeHandle(this.base, byteRange).read(options);\n  }\n\n  get supportsOffsetReads() {\n    return true;\n  }\n  get supportsSuffixReads() {\n    return true;\n  }\n  get singleKey() {\n    return true;\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ByteRangeKvStore } from \"#src/kvstore/byte_range/index.js\";\nimport type { KvStoreAdapterProvider } from \"#src/kvstore/context.js\";\nimport { KvStoreFileHandle } from \"#src/kvstore/index.js\";\nimport { frontendBackendIsomorphicKvStoreProviderRegistry } from \"#src/kvstore/register.js\";\nimport { ensureNoQueryOrFragmentParameters } from \"#src/kvstore/url.js\";\n\nfunction byteRangeProvider(): KvStoreAdapterProvider {\n  return {\n    scheme: \"byte-range\",\n    description: `byte range slicing`,\n    getKvStore(url, base) {\n      ensureNoQueryOrFragmentParameters(url);\n      return {\n        store: new ByteRangeKvStore(\n          new KvStoreFileHandle(base.store, base.path),\n        ),\n        path: url.suffix ?? \"\",\n      };\n    },\n  };\n}\n\nfrontendBackendIsomorphicKvStoreProviderRegistry.registerKvStoreAdapterProvider(\n  byteRangeProvider,\n);\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AutoDetectRegistry } from \"#src/kvstore/auto_detect.js\";\nimport type {\n  KvStoreWithPath,\n  ListResponse,\n  ReadResponse,\n  ReadOptions,\n  ListOptions,\n  StatOptions,\n  StatResponse,\n  FileHandle,\n} from \"#src/kvstore/index.js\";\nimport {\n  KvStoreFileHandle,\n  listKvStore,\n  readKvStore,\n} from \"#src/kvstore/index.js\";\nimport type { UrlWithParsedScheme } from \"#src/kvstore/url.js\";\nimport { resolveRelativePath, splitPipelineUrl } from \"#src/kvstore/url.js\";\nimport type {\n  BasicCompletionResult,\n  CompletionWithDescription,\n} from \"#src/util/completion.js\";\nimport type { ProgressOptions } from \"#src/util/progress_listener.js\";\n\nexport type CompletionResult = BasicCompletionResult<CompletionWithDescription>;\n\nexport interface BaseKvStoreProvider {\n  scheme: string;\n  hidden?: boolean;\n  description?: string;\n  getKvStore(parsedUrl: UrlWithParsedScheme): KvStoreWithPath;\n  completeUrl?: (\n    options: BaseKvStoreCompleteUrlOptions,\n  ) => Promise<CompletionResult | undefined>;\n}\n\nexport interface BaseKvStoreCompleteUrlOptions\n  extends Partial<ProgressOptions> {\n  url: UrlWithParsedScheme;\n}\n\nexport interface KvStoreAdapterProvider {\n  scheme: string;\n  hidden?: boolean;\n  description?: string;\n  getKvStore(\n    parsedUrl: UrlWithParsedScheme,\n    base: KvStoreWithPath,\n  ): KvStoreWithPath;\n  completeUrl?: (\n    options: KvStoreAdapterCompleteUrlOptions,\n  ) => Promise<CompletionResult | undefined>;\n}\n\nexport interface KvStoreAdapterCompleteUrlOptions\n  extends Partial<ProgressOptions> {\n  url: UrlWithParsedScheme;\n  base: KvStoreWithPath;\n}\n\nexport class KvStoreContext {\n  baseKvStoreProviders = new Map<string, BaseKvStoreProvider>();\n  kvStoreAdapterProviders = new Map<string, KvStoreAdapterProvider>();\n  autoDetectRegistry = new AutoDetectRegistry();\n\n  getKvStore(url: string): KvStoreWithPath {\n    const pipeline = splitPipelineUrl(url);\n    let kvStore: KvStoreWithPath;\n    {\n      const basePart = pipeline[0];\n      kvStore = this.getBaseKvStoreProvider(basePart).getKvStore(basePart);\n    }\n    for (let i = 1; i < pipeline.length; ++i) {\n      kvStore = this.applyKvStoreAdapterUrl(kvStore, pipeline[i]);\n    }\n    return kvStore;\n  }\n\n  getFileHandle(url: string): FileHandle {\n    const { store, path } = this.getKvStore(url);\n    return new KvStoreFileHandle(store, path);\n  }\n\n  getBaseKvStoreProvider(url: UrlWithParsedScheme): BaseKvStoreProvider {\n    const provider = this.baseKvStoreProviders.get(url.scheme);\n    if (provider === undefined) {\n      const usage = this.describeProtocolUsage(url.scheme);\n      let message = `Invalid base kvstore protocol \"${url.scheme}:\"`;\n      if (usage !== undefined) {\n        message += `; ${usage}`;\n      }\n      throw new Error(message);\n    }\n    return provider;\n  }\n\n  getKvStoreAdapterProvider(\n    adapterUrl: UrlWithParsedScheme,\n  ): KvStoreAdapterProvider {\n    const provider = this.kvStoreAdapterProviders.get(adapterUrl.scheme);\n    if (provider === undefined) {\n      const usage = this.describeProtocolUsage(adapterUrl.scheme);\n      let message = `Invalid kvstore adapter protocol \"${adapterUrl.scheme}:\"`;\n      if (usage !== undefined) {\n        message += `; ${usage}`;\n      }\n      message += `; supported schemes: ${JSON.stringify(Array.from(this.kvStoreAdapterProviders.keys()))}`;\n      throw new Error(message);\n    }\n    return provider;\n  }\n\n  applyKvStoreAdapterUrl(\n    base: KvStoreWithPath,\n    adapterUrl: UrlWithParsedScheme,\n  ): KvStoreWithPath {\n    return this.getKvStoreAdapterProvider(adapterUrl).getKvStore(\n      adapterUrl,\n      base,\n    );\n  }\n\n  // Describes valid uses of `protocol`, for error messages indicating an\n  // invalid protocol.  If the protocol is unknown, returns `undefined`.\n  describeProtocolUsage(protocol: string): string | undefined {\n    if (this.baseKvStoreProviders.has(protocol)) {\n      return `\"${protocol}:\" may only be used as a base kvstore protocol`;\n    }\n    if (this.kvStoreAdapterProviders.has(protocol)) {\n      return `\"${protocol}:\" may only be used as a kvstore adapter protocol`;\n    }\n    return undefined;\n  }\n\n  stat(\n    url: string,\n    options: StatOptions = {},\n  ): Promise<StatResponse | undefined> {\n    const kvStore = this.getKvStore(url);\n    return kvStore.store.stat(kvStore.path, options);\n  }\n\n  read(\n    url: string,\n    options: ReadOptions & { throwIfMissing: true },\n  ): Promise<ReadResponse>;\n\n  read(url: string, options?: ReadOptions): Promise<ReadResponse | undefined>;\n\n  read(\n    url: string,\n    options: ReadOptions = {},\n  ): Promise<ReadResponse | undefined> {\n    const kvStore = this.getKvStore(url);\n    return readKvStore(kvStore.store, kvStore.path, options);\n  }\n\n  list(urlPrefix: string, options: ListOptions = {}): Promise<ListResponse> {\n    const kvStore = this.getKvStore(urlPrefix);\n    return listKvStore(kvStore.store, kvStore.path, options);\n  }\n\n  resolveRelativePath(baseUrl: string, relativePath: string): string {\n    const kvStore = this.getKvStore(baseUrl);\n    return kvStore.store.getUrl(\n      resolveRelativePath(kvStore.path, relativePath),\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { read, stat } from \"#src/kvstore/http/read.js\";\nimport type {\n  KvStore,\n  DriverListOptions,\n  ListResponse,\n  DriverReadOptions,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n} from \"#src/kvstore/index.js\";\nimport { encodePathForUrl } from \"#src/kvstore/url.js\";\nimport type { FetchOk } from \"#src/util/http_request.js\";\nimport { fetchOk } from \"#src/util/http_request.js\";\nimport {\n  parseArray,\n  verifyObject,\n  verifyObjectProperty,\n  verifyOptionalObjectProperty,\n  verifyString,\n  verifyStringArray,\n} from \"#src/util/json.js\";\nimport { ProgressSpan } from \"#src/util/progress_listener.js\";\nimport { getRandomHexString } from \"#src/util/random.js\";\n\nexport class GcsKvStore implements KvStore {\n  constructor(\n    public bucket: string,\n    public baseUrlForDisplay: string = `gs://${bucket}/`,\n    private fetchOkImpl: FetchOk = fetchOk,\n  ) {}\n\n  private getObjectUrl(key: string): string {\n    // Include random query string parameter (ignored by GCS) to bypass GCS cache\n    // and ensure a cached response is never used.\n    //\n    // This addresses two issues related to GCS:\n    //\n    // 1. GCS fails to send an updated `Access-Control-Allow-Origin` header in 304\n    //    responses to cache revalidation requests.\n    //\n    //    https://bugs.chromium.org/p/chromium/issues/detail?id=1214563#c2\n    //\n    //    The random query string parameter ensures cached responses are never used.\n    //\n    //    Note: This issue does not apply to gs+xml because with the XML API, the\n    //    Access-Control-Allow-Origin response header does not vary with the Origin.\n    //\n    // 2. If the object does not prohibit caching (e.g. public bucket and default\n    //    `cache-control` metadata value), GCS may return stale responses.\n    return (\n      `https://storage.googleapis.com/storage/v1/b/${this.bucket}/o/` +\n      `${encodeURIComponent(key)}?alt=media` +\n      `&neuroglancer=${getRandomHexString()}`\n    );\n  }\n\n  stat(key: string, options: StatOptions): Promise<StatResponse | undefined> {\n    return stat(this, key, this.getObjectUrl(key), options, this.fetchOkImpl);\n  }\n\n  read(\n    key: string,\n    options: DriverReadOptions,\n  ): Promise<ReadResponse | undefined> {\n    return read(this, key, this.getObjectUrl(key), options, this.fetchOkImpl);\n  }\n\n  async list(\n    prefix: string,\n    options: DriverListOptions,\n  ): Promise<ListResponse> {\n    const { progressListener } = options;\n    using _span =\n      progressListener === undefined\n        ? undefined\n        : new ProgressSpan(progressListener, {\n            message: `Listing prefix ${this.getUrl(prefix)}`,\n          });\n    const delimiter = \"/\";\n    // Include `neuroglancerOrigin` query parameter that is ignored by GCS to\n    // workaround\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=1214563#c2 (though\n    // it is not clear it would ever apply to bucket listing).\n    const response = await this.fetchOkImpl(\n      `https://storage.googleapis.com/storage/v1/b/${this.bucket}/o?` +\n        `delimiter=${encodeURIComponent(delimiter)}&prefix=${encodeURIComponent(\n          prefix,\n        )}&` +\n        `neuroglancerOrigin=${encodeURIComponent(location.origin)}`,\n      {\n        signal: options.signal,\n        progressListener: options.progressListener,\n      },\n    );\n    const responseJson = await response.json();\n\n    verifyObject(responseJson);\n    const directories = verifyOptionalObjectProperty(\n      responseJson,\n      \"prefixes\",\n      verifyStringArray,\n      [],\n    ).map((prefix) => prefix.substring(0, prefix.length - 1));\n\n    const entries = verifyOptionalObjectProperty(\n      responseJson,\n      \"items\",\n      (items) =>\n        parseArray(items, (item) => {\n          verifyObject(item);\n          return verifyObjectProperty(item, \"name\", verifyString);\n        }),\n      [],\n    )\n      .filter((name) => !name.endsWith(\"_$folder$\"))\n      .map((name) => ({ key: name }));\n\n    return {\n      directories,\n      entries,\n    };\n  }\n\n  getUrl(path: string) {\n    return this.baseUrlForDisplay + encodePathForUrl(path);\n  }\n\n  get supportsOffsetReads() {\n    return true;\n  }\n  get supportsSuffixReads() {\n    return true;\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport pythonIntegration from \"#python_integration_build\";\nimport type { BaseKvStoreProvider } from \"#src/kvstore/context.js\";\nimport { GcsKvStore } from \"#src/kvstore/gcs/index.js\";\nimport type { SharedKvStoreContextBase } from \"#src/kvstore/register.js\";\nimport { frontendBackendIsomorphicKvStoreProviderRegistry } from \"#src/kvstore/register.js\";\n\nfunction gcsProvider(_context: SharedKvStoreContextBase): BaseKvStoreProvider {\n  return {\n    scheme: \"gs\",\n    description: pythonIntegration\n      ? \"Google Cloud Storage\"\n      : \"Google Cloud Storage (anonymous)\",\n    getKvStore(url) {\n      const m = (url.suffix ?? \"\").match(/^\\/\\/([^/]+)(\\/.*)?$/);\n      if (m === null) {\n        throw new Error(\"Invalid URL, expected `gs://<bucket>/<path>`\");\n      }\n      const [, bucket, path] = m;\n      return {\n        store: new GcsKvStore(bucket),\n        path: decodeURIComponent((path ?? \"\").substring(1)),\n      };\n    },\n  };\n}\n\nfrontendBackendIsomorphicKvStoreProviderRegistry.registerBaseKvStoreProvider(\n  gcsProvider,\n);\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  DriverReadOptions,\n  FileHandle,\n  ReadableKvStore,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n} from \"#src/kvstore/index.js\";\nimport { decodeGzipStream } from \"#src/util/gzip.js\";\n\nexport const EXPECTED_HEADER_OVERHEAD = 100;\n\nexport class GzipFileHandle<BaseHandle extends FileHandle = FileHandle>\n  implements FileHandle\n{\n  constructor(\n    public base: BaseHandle,\n    public format: CompressionFormat,\n  ) {}\n\n  async stat(options: StatOptions): Promise<StatResponse | undefined> {\n    await this.base.stat(options);\n    return { totalSize: undefined };\n  }\n\n  async read(options: DriverReadOptions): Promise<ReadResponse | undefined> {\n    const { byteRange } = options;\n    if (byteRange === undefined) {\n      const readResponse = await this.base.read(options);\n      if (readResponse === undefined) return undefined;\n      return {\n        response: new Response(\n          decodeGzipStream(readResponse.response, this.format),\n        ),\n        offset: 0,\n        length: undefined,\n        totalSize: undefined,\n      };\n    }\n    if (\"suffixLength\" in byteRange || byteRange.offset !== 0) {\n      throw new Error(\n        `Byte range with offset not supported: ${JSON.stringify(byteRange)}`,\n      );\n    }\n\n    // There is no way to force a flush on a `DecompressionStream`; to ensure we\n    // have all available output from the input, we must close the readable\n    // stream, which prevents any further writes. This means if more input is\n    // required, we have to redo the decode. In almost all cases, though,\n    // `EXPECTED_HEADER_OVERHEAD` should be sufficient and it won't be necessary\n    // to fetch additional encoded data.\n    let decodedArray = new Uint8Array(byteRange.length);\n    const parts: Uint8Array<ArrayBuffer>[] = [];\n    let encodedBytesReceived = 0;\n    let expectedEncodedBytes = byteRange.length + EXPECTED_HEADER_OVERHEAD;\n    while (true) {\n      const readResponse = await this.base.read({\n        ...options,\n        byteRange: {\n          offset: encodedBytesReceived,\n          length: expectedEncodedBytes - encodedBytesReceived,\n        },\n      });\n      if (readResponse === undefined) return undefined;\n      {\n        const part = new Uint8Array(await readResponse.response.arrayBuffer());\n        parts.push(part);\n        encodedBytesReceived += part.length;\n      }\n\n      const decompressionStream = new DecompressionStream(\"gzip\");\n      const writer = decompressionStream.writable.getWriter();\n      const writePromises: Promise<void>[] = [];\n      for (const part of parts) {\n        writePromises.push(writer.write(part));\n      }\n      writePromises.push(writer.close());\n      const reader = decompressionStream.readable.getReader();\n      let decodedOffset = 0;\n      try {\n        while (decodedOffset < decodedArray.length) {\n          let { value } = await reader.read();\n          if (value === undefined) {\n            // no more decoded data available\n            break;\n          }\n          const remainingLength = decodedArray.length - decodedOffset;\n          if (value.length > remainingLength) {\n            value = value.subarray(0, remainingLength);\n          }\n          decodedArray.set(value, decodedOffset);\n          decodedOffset += value.length;\n        }\n\n        if (\n          decodedOffset === decodedArray.length ||\n          encodedBytesReceived === readResponse.totalSize\n        ) {\n          if (decodedOffset < decodedArray.length) {\n            decodedArray = decodedArray.subarray(0, decodedOffset);\n          }\n          return {\n            response: new Response(decodedArray),\n            offset: 0,\n            length: decodedArray.length,\n            totalSize: undefined,\n          };\n        }\n      } finally {\n        await reader.cancel();\n        await Promise.allSettled(writePromises);\n      }\n\n      expectedEncodedBytes += Math.min(\n        100,\n        decodedArray.length - decodedOffset,\n      );\n    }\n  }\n\n  getUrl() {\n    return this.base.getUrl() + \"|gzip\";\n  }\n}\n\nexport async function gzipRead<Key>(\n  base: ReadableKvStore<Key>,\n  baseKey: Key,\n  format: CompressionFormat,\n  options: DriverReadOptions,\n) {\n  const { byteRange } = options;\n  if (byteRange === undefined) {\n    const readResponse = await base.read(baseKey, options);\n    if (readResponse === undefined) return undefined;\n    return {\n      response: new Response(decodeGzipStream(readResponse.response, format)),\n      offset: 0,\n      length: undefined,\n      totalSize: undefined,\n    };\n  }\n  if (\"suffixLength\" in byteRange || byteRange.offset !== 0) {\n    throw new Error(\n      `Byte range with offset not supported: ${JSON.stringify(byteRange)}`,\n    );\n  }\n\n  // There is no way to force a flush on a `DecompressionStream`; to ensure we\n  // have all available output from the input, we must close the readable\n  // stream, which prevents any further writes. This means if more input is\n  // required, we have to redo the decode. In almost all cases, though,\n  // `EXPECTED_HEADER_OVERHEAD` should be sufficient and it won't be necessary\n  // to fetch additional encoded data.\n  let decodedArray = new Uint8Array(byteRange.length);\n  const parts: Uint8Array<ArrayBuffer>[] = [];\n  let encodedBytesReceived = 0;\n  let expectedEncodedBytes = byteRange.length + EXPECTED_HEADER_OVERHEAD;\n  while (true) {\n    const readResponse = await base.read(baseKey, {\n      ...options,\n      byteRange: {\n        offset: encodedBytesReceived,\n        length: expectedEncodedBytes - encodedBytesReceived,\n      },\n    });\n    if (readResponse === undefined) return undefined;\n    {\n      const part = new Uint8Array(await readResponse.response.arrayBuffer());\n      parts.push(part);\n      encodedBytesReceived += part.length;\n    }\n\n    const decompressionStream = new DecompressionStream(\"gzip\");\n    const writer = decompressionStream.writable.getWriter();\n    const writePromises: Promise<void>[] = [];\n    for (const part of parts) {\n      writePromises.push(writer.write(part));\n    }\n    writePromises.push(writer.close());\n    const reader = decompressionStream.readable.getReader();\n    let decodedOffset = 0;\n    try {\n      while (decodedOffset < decodedArray.length) {\n        let { value } = await reader.read();\n        if (value === undefined) {\n          // no more decoded data available\n          break;\n        }\n        const remainingLength = decodedArray.length - decodedOffset;\n        if (value.length > remainingLength) {\n          value = value.subarray(0, remainingLength);\n        }\n        decodedArray.set(value, decodedOffset);\n        decodedOffset += value.length;\n      }\n\n      if (\n        decodedOffset === decodedArray.length ||\n        encodedBytesReceived === readResponse.totalSize\n      ) {\n        if (decodedOffset < decodedArray.length) {\n          decodedArray = decodedArray.subarray(0, decodedOffset);\n        }\n        return {\n          response: new Response(decodedArray),\n          offset: 0,\n          length: decodedArray.length,\n          totalSize: undefined,\n        };\n      }\n    } finally {\n      await reader.cancel();\n      await Promise.allSettled(writePromises);\n    }\n\n    expectedEncodedBytes += Math.min(100, decodedArray.length - decodedOffset);\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  AutoDetectFileOptions,\n  AutoDetectMatch,\n  AutoDetectRegistry,\n} from \"#src/kvstore/auto_detect.js\";\nimport { GzipFileHandle } from \"#src/kvstore/gzip/file_handle.js\";\nimport type {\n  DriverReadOptions,\n  KvStore,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n  FileHandle,\n} from \"#src/kvstore/index.js\";\nimport { isGzipFormat } from \"#src/util/gzip.js\";\n\nexport class GzipKvStore implements KvStore {\n  constructor(\n    public base: FileHandle,\n    public scheme: string,\n    public format: CompressionFormat,\n  ) {}\n\n  getUrl(key: string) {\n    this.validatePath(key);\n    return this.base.getUrl() + `|${this.scheme}`;\n  }\n\n  private validatePath(path: string) {\n    if (path) {\n      throw new Error(\n        `\"${this.scheme}:\" does not support non-empty path ${JSON.stringify(path)}`,\n      );\n    }\n  }\n\n  async stat(\n    key: string,\n    options: StatOptions,\n  ): Promise<StatResponse | undefined> {\n    this.validatePath(key);\n    await this.base.stat(options);\n    return { totalSize: undefined };\n  }\n\n  async read(\n    key: string,\n    options: DriverReadOptions,\n  ): Promise<ReadResponse | undefined> {\n    this.validatePath(key);\n    return new GzipFileHandle(this.base, this.format).read(options);\n  }\n\n  get supportsOffsetReads() {\n    return false;\n  }\n  get supportsSuffixReads() {\n    return false;\n  }\n  get singleKey() {\n    return true;\n  }\n}\n\nasync function detectGzip(\n  options: AutoDetectFileOptions,\n): Promise<AutoDetectMatch[]> {\n  if (!isGzipFormat(options.prefix)) {\n    return [];\n  }\n  return [{ suffix: \"gzip:\", description: \"gzip-compressed\" }];\n}\n\nexport function registerAutoDetect(registry: AutoDetectRegistry) {\n  registry.registerFileFormat({\n    prefixLength: 3,\n    suffixLength: 0,\n    match: detectGzip,\n  });\n}\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { KvStoreAdapterProvider } from \"#src/kvstore/context.js\";\nimport { GzipKvStore, registerAutoDetect } from \"#src/kvstore/gzip/index.js\";\nimport { KvStoreFileHandle } from \"#src/kvstore/index.js\";\nimport { frontendBackendIsomorphicKvStoreProviderRegistry } from \"#src/kvstore/register.js\";\nimport { ensureEmptyUrlSuffix } from \"#src/kvstore/url.js\";\n\nfunction gzipProvider(\n  scheme: string,\n  format: CompressionFormat,\n): KvStoreAdapterProvider {\n  return {\n    scheme,\n    description: `transparent ${scheme} decoding`,\n    getKvStore(url, base) {\n      ensureEmptyUrlSuffix(url);\n      return {\n        store: new GzipKvStore(\n          new KvStoreFileHandle(base.store, base.path),\n          scheme,\n          format,\n        ),\n        path: \"\",\n      };\n    },\n  };\n}\n\nfrontendBackendIsomorphicKvStoreProviderRegistry.registerKvStoreAdapterProvider(\n  () => gzipProvider(\"gzip\", \"gzip\"),\n);\n\nregisterAutoDetect(\n  frontendBackendIsomorphicKvStoreProviderRegistry.autoDetectRegistry,\n);\n","/**\n * @license\n * Copyright 2023 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BaseKvStoreProvider } from \"#src/kvstore/context.js\";\nimport { read, stat } from \"#src/kvstore/http/read.js\";\nimport type {\n  KvStore,\n  DriverReadOptions,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n} from \"#src/kvstore/index.js\";\nimport type {\n  KvStoreProviderRegistry,\n  SharedKvStoreContextBase,\n} from \"#src/kvstore/register.js\";\nimport { getBaseHttpUrlAndPath, joinBaseUrlAndPath } from \"#src/kvstore/url.js\";\nimport type { FetchOk } from \"#src/util/http_request.js\";\nimport { fetchOk } from \"#src/util/http_request.js\";\n\nexport class ReadableHttpKvStore<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n> implements KvStore\n{\n  constructor(\n    public sharedKvStoreContext: SharedKvStoreContext,\n    public baseUrl: string,\n    public baseUrlForDisplay: string = baseUrl,\n    public fetchOkImpl: FetchOk = fetchOk,\n  ) {}\n\n  stat(key: string, options: StatOptions): Promise<StatResponse | undefined> {\n    return stat(\n      this,\n      key,\n      joinBaseUrlAndPath(this.baseUrl, key),\n      options,\n      this.fetchOkImpl,\n    );\n  }\n\n  read(\n    key: string,\n    options: DriverReadOptions,\n  ): Promise<ReadResponse | undefined> {\n    return read(\n      this,\n      key,\n      joinBaseUrlAndPath(this.baseUrl, key),\n      options,\n      this.fetchOkImpl,\n    );\n  }\n\n  getUrl(path: string) {\n    return joinBaseUrlAndPath(this.baseUrlForDisplay, path);\n  }\n\n  get supportsOffsetReads() {\n    return true;\n  }\n  get supportsSuffixReads() {\n    return true;\n  }\n}\n\nfunction httpProvider<SharedKvStoreContext extends SharedKvStoreContextBase>(\n  scheme: string,\n  sharedKvStoreContext: SharedKvStoreContext,\n  httpKvStoreClass: typeof ReadableHttpKvStore<SharedKvStoreContext>,\n): BaseKvStoreProvider {\n  return {\n    scheme,\n    description: `${scheme} (unauthenticated)`,\n    getKvStore(url) {\n      try {\n        const { baseUrl, path } = getBaseHttpUrlAndPath(url.url);\n        return {\n          store: new httpKvStoreClass(sharedKvStoreContext, baseUrl),\n          path,\n        };\n      } catch (e) {\n        throw new Error(`Invalid URL ${JSON.stringify(url.url)}`, {\n          cause: e,\n        });\n      }\n    },\n  };\n}\n\nexport function registerProviders<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n>(\n  registry: KvStoreProviderRegistry<SharedKvStoreContext>,\n  httpKvStoreClass: typeof ReadableHttpKvStore<SharedKvStoreContext>,\n) {\n  for (const httpScheme of [\"http\", \"https\"]) {\n    registry.registerBaseKvStoreProvider((context) =>\n      httpProvider(httpScheme, context, httpKvStoreClass),\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  CredentialsManager,\n  CredentialsProvider,\n} from \"#src/credentials_provider/index.js\";\nimport type { OAuth2Credentials } from \"#src/credentials_provider/oauth2.js\";\nimport { fetchOkWithOAuth2CredentialsAdapter } from \"#src/credentials_provider/oauth2.js\";\nimport type { BaseKvStoreProvider } from \"#src/kvstore/context.js\";\nimport type { ReadableHttpKvStore } from \"#src/kvstore/http/common.js\";\nimport type {\n  KvStoreProviderRegistry,\n  SharedKvStoreContextBase,\n} from \"#src/kvstore/register.js\";\nimport { getBaseHttpUrlAndPath } from \"#src/kvstore/url.js\";\n\nconst SCHEME_PREFIX = \"middleauth+\";\n\nfunction getMiddleAuthCredentialsProvider(\n  credentialsManager: CredentialsManager,\n  url: string,\n): CredentialsProvider<OAuth2Credentials> {\n  return credentialsManager.getCredentialsProvider(\n    \"middleauthapp\",\n    new URL(url).origin,\n  );\n}\n\nfunction middleauthProvider<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n>(\n  scheme: string,\n  context: SharedKvStoreContext,\n  httpKvStoreClass: typeof ReadableHttpKvStore<SharedKvStoreContext>,\n): BaseKvStoreProvider {\n  return {\n    scheme: SCHEME_PREFIX + scheme,\n    description: `${scheme} with middleauth`,\n    getKvStore(url) {\n      const httpUrl = url.url.substring(SCHEME_PREFIX.length);\n      const credentialsProvider = getMiddleAuthCredentialsProvider(\n        context.credentialsManager,\n        httpUrl,\n      );\n      try {\n        const { baseUrl, path } = getBaseHttpUrlAndPath(httpUrl);\n        return {\n          store: new httpKvStoreClass(\n            context,\n            baseUrl,\n            SCHEME_PREFIX + baseUrl,\n            fetchOkWithOAuth2CredentialsAdapter(credentialsProvider),\n          ),\n          path,\n        };\n      } catch (e) {\n        throw new Error(`Invalid URL ${JSON.stringify(url.url)}`, {\n          cause: e,\n        });\n      }\n    },\n  };\n}\n\nexport function registerProviders<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n>(\n  registry: KvStoreProviderRegistry<SharedKvStoreContext>,\n  httpKvStoreClass: typeof ReadableHttpKvStore<SharedKvStoreContext>,\n) {\n  for (const httpScheme of [\"https\"]) {\n    registry.registerBaseKvStoreProvider((context) =>\n      middleauthProvider(httpScheme, context, httpKvStoreClass),\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport pythonIntegration from \"#python_integration_build\";\nimport type {\n  CredentialsManager,\n  CredentialsProvider,\n} from \"#src/credentials_provider/index.js\";\nimport type { OAuth2Credentials } from \"#src/credentials_provider/oauth2.js\";\nimport { fetchOkWithOAuth2CredentialsAdapter } from \"#src/credentials_provider/oauth2.js\";\nimport type { BaseKvStoreProvider } from \"#src/kvstore/context.js\";\nimport { GcsKvStore } from \"#src/kvstore/gcs/index.js\";\nimport type { SharedKvStoreContextBase } from \"#src/kvstore/register.js\";\nimport { frontendBackendIsomorphicKvStoreProviderRegistry } from \"#src/kvstore/register.js\";\n\nfunction getNgauthCredentialsProvider(\n  credentialsManager: CredentialsManager,\n  authServer: string,\n  bucket: string,\n): CredentialsProvider<OAuth2Credentials> {\n  return pythonIntegration\n    ? credentialsManager.getCredentialsProvider(\"gcs\", { bucket })\n    : credentialsManager.getCredentialsProvider(\"ngauth_gcs\", {\n        authServer: authServer,\n        bucket,\n      });\n}\n\nconst SCHEME_PREFIX = \"gs+ngauth+\";\n\nfunction gcsNgauthProvider(\n  scheme: string,\n  context: SharedKvStoreContextBase,\n): BaseKvStoreProvider {\n  return {\n    scheme,\n    description: pythonIntegration\n      ? \"Google Cloud Storage\"\n      : \"Google Cloud Storage (ngauth)\",\n    getKvStore(url) {\n      const m = (url.suffix ?? \"\").match(/^\\/\\/([^/]+)\\/([^/]+)(\\/.*)?$/);\n      if (m === null) {\n        throw new Error(\n          `Invalid URL, expected ${url.scheme}://<ngauth-server>/<bucket>/<path>`,\n        );\n      }\n      const [, authHost, bucket, path] = m;\n      const authUrl =\n        url.scheme.substring(SCHEME_PREFIX.length) + \"://\" + authHost;\n      const credentialsProvider = getNgauthCredentialsProvider(\n        context.credentialsManager,\n        authUrl,\n        bucket,\n      );\n      return {\n        store: new GcsKvStore(\n          bucket,\n          `${url.scheme}://${authHost}/${bucket}/`,\n          fetchOkWithOAuth2CredentialsAdapter(credentialsProvider),\n        ),\n        path: decodeURIComponent((path ?? \"\").substring(1)),\n      };\n    },\n  };\n}\n\nfor (const scheme of [\"http\", \"https\"]) {\n  frontendBackendIsomorphicKvStoreProviderRegistry.registerBaseKvStoreProvider(\n    (context) => gcsNgauthProvider(`${SCHEME_PREFIX}${scheme}`, context),\n  );\n}\n","/**\n * @license\n * Copyright 2025 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { KvStoreWithPath } from \"#src/kvstore/index.js\";\nimport type { VersionSpecifier } from \"#src/kvstore/ocdbt/version_specifier.js\";\nimport {\n  formatVersion,\n  parseVersion,\n} from \"#src/kvstore/ocdbt/version_specifier.js\";\nimport type { UrlWithParsedScheme } from \"#src/kvstore/url.js\";\nimport {\n  encodePathForUrl,\n  ensureNoQueryOrFragmentParameters,\n  ensurePathIsDirectory,\n} from \"#src/kvstore/url.js\";\n\nexport function getOcdbtUrl(\n  options: { baseUrl: string; version: VersionSpecifier | undefined },\n  key: string,\n): string {\n  const { version, baseUrl } = options;\n  const versionString =\n    version === undefined ? \"\" : `@${formatVersion(version)}/`;\n  return baseUrl + `|ocdbt:${versionString}${encodePathForUrl(key)}`;\n}\n\nexport function parseOcdbtUrl(\n  parsedUrl: UrlWithParsedScheme,\n  base: KvStoreWithPath,\n) {\n  ensureNoQueryOrFragmentParameters(parsedUrl);\n  try {\n    const m = (parsedUrl.suffix ?? \"\").match(/^(?:@([^/]*)(?:\\/|$))?(.*)$/)!;\n    const [, versionString, path] = m;\n    return {\n      baseUrl: base.store.getUrl(ensurePathIsDirectory(base.path)),\n      version: parseVersion(versionString),\n      path: decodeURIComponent(path),\n    };\n  } catch (e) {\n    throw new Error(`Invalid URL: ${parsedUrl.url}`, { cause: e });\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { CredentialsManager } from \"#src/credentials_provider/index.js\";\nimport { AutoDetectRegistry } from \"#src/kvstore/auto_detect.js\";\nimport type {\n  BaseKvStoreProvider,\n  KvStoreAdapterProvider,\n  KvStoreContext,\n} from \"#src/kvstore/context.js\";\nimport type { StringMemoize } from \"#src/util/memoize.js\";\nimport type { RPC, RpcId } from \"#src/worker_rpc.js\";\n\nexport interface SharedKvStoreContextBase {\n  kvStoreContext: KvStoreContext;\n  credentialsManager: CredentialsManager;\n  chunkManager: { memoize: StringMemoize };\n  rpc: RPC | null;\n  rpcId: RpcId | null;\n}\n\nexport class KvStoreProviderRegistry<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n> {\n  baseKvStoreProviders: Array<\n    (context: SharedKvStoreContext) => BaseKvStoreProvider\n  > = [];\n  kvStoreAdapterProviders: Array<\n    (context: SharedKvStoreContext) => KvStoreAdapterProvider\n  > = [];\n  autoDetectRegistry = new AutoDetectRegistry();\n\n  registerBaseKvStoreProvider(\n    provider: (context: SharedKvStoreContext) => BaseKvStoreProvider,\n  ) {\n    this.baseKvStoreProviders.push(provider);\n  }\n\n  registerKvStoreAdapterProvider(\n    provider: (context: SharedKvStoreContext) => KvStoreAdapterProvider,\n  ) {\n    this.kvStoreAdapterProviders.push(provider);\n  }\n\n  applyToContext(context: SharedKvStoreContext) {\n    const { kvStoreContext } = context;\n    for (const key of [\n      \"baseKvStoreProviders\",\n      \"kvStoreAdapterProviders\",\n    ] as const) {\n      const map = kvStoreContext[key];\n      for (const providerFactory of this[key]) {\n        const provider = providerFactory(context);\n        const { scheme } = provider;\n        if (map.has(scheme)) {\n          throw new Error(`Duplicate kvstore scheme ${scheme}`);\n        }\n        map.set(scheme, provider as any);\n      }\n    }\n    this.autoDetectRegistry.copyTo(context.kvStoreContext.autoDetectRegistry);\n  }\n}\n\nexport const frontendBackendIsomorphicKvStoreProviderRegistry =\n  new KvStoreProviderRegistry<SharedKvStoreContextBase>();\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { BaseKvStoreProvider } from \"#src/kvstore/context.js\";\nimport { read, stat } from \"#src/kvstore/http/read.js\";\nimport type {\n  KvStore,\n  DriverListOptions,\n  ListResponse,\n  DriverReadOptions,\n  ReadResponse,\n  StatOptions,\n  StatResponse,\n} from \"#src/kvstore/index.js\";\nimport type {\n  KvStoreProviderRegistry,\n  SharedKvStoreContextBase,\n} from \"#src/kvstore/register.js\";\nimport {\n  getS3BucketListing,\n  listS3CompatibleUrl,\n} from \"#src/kvstore/s3/list.js\";\nimport { joinBaseUrlAndPath } from \"#src/kvstore/url.js\";\nimport type { FetchOk } from \"#src/util/http_request.js\";\nimport { fetchOk } from \"#src/util/http_request.js\";\nimport { ProgressSpan } from \"#src/util/progress_listener.js\";\n\nexport class ReadableS3KvStore<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n> implements KvStore\n{\n  constructor(\n    public sharedKvStoreContext: SharedKvStoreContext,\n    public baseUrl: string,\n    public baseUrlForDisplay: string,\n    protected knownToBeVirtualHostedStyle: boolean,\n    protected fetchOkImpl: FetchOk = fetchOk,\n  ) {}\n\n  stat(key: string, options: StatOptions): Promise<StatResponse | undefined> {\n    const url = joinBaseUrlAndPath(this.baseUrl, key);\n    return stat(this, key, url, options, this.fetchOkImpl);\n  }\n\n  read(\n    key: string,\n    options: DriverReadOptions,\n  ): Promise<ReadResponse | undefined> {\n    const url = joinBaseUrlAndPath(this.baseUrl, key);\n    return read(this, key, url, options, this.fetchOkImpl);\n  }\n\n  list(prefix: string, options: DriverListOptions): Promise<ListResponse> {\n    const { progressListener } = options;\n    using _span =\n      progressListener === undefined\n        ? undefined\n        : new ProgressSpan(progressListener, {\n            message: `Listing prefix ${this.getUrl(prefix)}`,\n          });\n    if (this.knownToBeVirtualHostedStyle) {\n      return getS3BucketListing(\n        this.baseUrl,\n        prefix,\n        this.fetchOkImpl,\n        options,\n      );\n    }\n    return listS3CompatibleUrl(\n      joinBaseUrlAndPath(this.baseUrl, prefix),\n      this.baseUrlForDisplay,\n      this.sharedKvStoreContext.chunkManager.memoize,\n      this.fetchOkImpl,\n      options,\n    );\n  }\n\n  getUrl(path: string) {\n    return joinBaseUrlAndPath(this.baseUrlForDisplay, path);\n  }\n\n  get supportsOffsetReads() {\n    return true;\n  }\n  get supportsSuffixReads() {\n    return true;\n  }\n}\n\nfunction amazonS3Provider<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n>(\n  sharedKvStoreContext: SharedKvStoreContext,\n  s3KvStoreClass: typeof ReadableS3KvStore<SharedKvStoreContext>,\n): BaseKvStoreProvider {\n  return {\n    scheme: \"s3\",\n    description: \"S3 (anonymous)\",\n    getKvStore(url) {\n      const m = (url.suffix ?? \"\").match(/^\\/\\/([^/]+)(\\/.*)?$/);\n      if (m === null) {\n        throw new Error(\"Invalid URL, expected `s3://<bucket>/<path>`\");\n      }\n      const [, bucket, path] = m;\n      return {\n        store: new s3KvStoreClass(\n          sharedKvStoreContext,\n          `https://${bucket}.s3.amazonaws.com/`,\n          `s3://${bucket}/`,\n          /*knownToBeVirtualHostedStyle=*/ true,\n        ),\n        path: decodeURIComponent((path ?? \"\").substring(1)),\n      };\n    },\n  };\n}\n\nfunction s3Provider<SharedKvStoreContext extends SharedKvStoreContextBase>(\n  sharedKvStoreContext: SharedKvStoreContext,\n  httpScheme: \"http\" | \"https\",\n  s3KvStoreClass: typeof ReadableS3KvStore<SharedKvStoreContext>,\n): BaseKvStoreProvider {\n  return {\n    scheme: `s3+${httpScheme}`,\n    description: `S3-compatible ${httpScheme} server`,\n    getKvStore(url) {\n      const m = (url.suffix ?? \"\").match(/^\\/\\/([^/]+)(\\/.*)?$/);\n      if (m === null) {\n        throw new Error(\n          \"Invalid URL, expected `s3+${httpScheme}://<host>/<path>`\",\n        );\n      }\n      const [, host, path] = m;\n      return {\n        store: new s3KvStoreClass(\n          sharedKvStoreContext,\n          `${httpScheme}://${host}/`,\n          `s3+${httpScheme}://${host}/`,\n          /*knownToBeVirtualHostedStyle=*/ false,\n        ),\n        path: decodeURIComponent((path ?? \"\").substring(1)),\n      };\n    },\n  };\n}\n\nexport function registerProviders<\n  SharedKvStoreContext extends SharedKvStoreContextBase,\n>(\n  registry: KvStoreProviderRegistry<SharedKvStoreContext>,\n  s3KvStoreClass: typeof ReadableS3KvStore<SharedKvStoreContext>,\n) {\n  registry.registerBaseKvStoreProvider((context) =>\n    amazonS3Provider(context, s3KvStoreClass),\n  );\n\n  for (const httpScheme of [\"http\", \"https\"] as const) {\n    registry.registerBaseKvStoreProvider((context) =>\n      s3Provider(context, httpScheme, s3KvStoreClass),\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const SHARED_KVSTORE_CONTEXT_RPC_ID = \"SharedKvStoreContext\";\n\nexport const STAT_RPC_ID = \"SharedKvStoreContext.stat\";\nexport const READ_RPC_ID = \"SharedKvStoreContext.read\";\nexport const LIST_RPC_ID = \"SharedKvStoreContext.list\";\nexport const COMPLETE_URL_RPC_ID = \"SharedKvStoreContext.completeUrl\";\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const MESH_LAYER_RPC_ID = \"mesh/MeshLayer\";\nexport const MULTISCALE_MESH_LAYER_RPC_ID = \"mesh/MultiscaleMeshLayer\";\nexport const FRAGMENT_SOURCE_RPC_ID = \"mesh/FragmentSource\";\n\nexport const MULTISCALE_FRAGMENT_SOURCE_RPC_ID =\n  \"mesh/MultiscaleFragmentSource\";\n\nexport type EncodedVertexPositions = Float32Array | Uint32Array | Uint16Array;\nexport type MeshVertexIndices = Uint16Array | Uint32Array;\nexport type OctahedronVertexNormals = Uint8Array;\n\nexport interface EncodedMeshData {\n  vertexPositions: EncodedVertexPositions;\n  vertexNormals: OctahedronVertexNormals;\n  indices: MeshVertexIndices;\n  strips: boolean;\n}\n\nexport interface MultiscaleFragmentFormat {\n  /**\n   * If `true`, vertex positions are specified relative to the fragment bounds, meaning (0, 0, 0) is\n   * the start corner of the fragment and (1, 1, 1) is the end corner.\n   *\n   * If `false`, vertex positions are in \"model\" coordinates.\n   */\n  fragmentRelativeVertices: boolean;\n\n  vertexPositionFormat: VertexPositionFormat;\n}\n\nexport enum VertexPositionFormat {\n  float32 = 0,\n  uint10 = 1,\n  uint16 = 2,\n}\n","/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const PERSPECTIVE_VIEW_RPC_ID = \"perspective_view/PerspectiveView\";\n","/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const RENDERED_VIEW_ADD_LAYER_RPC_ID = \"rendered_view.addLayer\";\nexport const RENDERED_VIEW_REMOVE_LAYER_RPC_ID = \"rendered_view.removeLayer\";\nexport const PROJECTION_PARAMETERS_RPC_ID = \"SharedProjectionParameters\";\nexport const PROJECTION_PARAMETERS_CHANGED_RPC_METHOD_ID =\n  \"SharedProjectionParameters.changed\";\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DataType } from \"#src/util/data_type.js\";\n\nexport const SINGLE_MESH_LAYER_RPC_ID = \"single_mesh/SingleMeshLayer\";\nexport const GET_SINGLE_MESH_INFO_RPC_ID = \"single_mesh/getSingleMeshInfo\";\n\nexport const SINGLE_MESH_CHUNK_KEY = \"\";\n\nexport interface VertexAttributeInfo {\n  name: string;\n  dataType: DataType;\n  numComponents: number;\n  source?: string;\n  min?: number;\n  max?: number;\n}\n\nexport interface SingleMeshInfo {\n  numVertices: number;\n  numTriangles: number;\n  // Perhaps bounding box?\n  // Perhaps transform data?\n  vertexAttributes: VertexAttributeInfo[];\n}\n\nexport interface SingleMeshData {\n  vertexPositions: Float32Array<ArrayBuffer>;\n  indices: Uint32Array<ArrayBuffer>;\n  vertexNormals?: Float32Array<ArrayBuffer>;\n  vertexAttributes: Float32Array<ArrayBuffer>[];\n}\n\nexport class SingleMeshSourceParameters {\n  meshSourceUrl: string;\n}\n\nexport class SingleMeshSourceParametersWithInfo extends SingleMeshSourceParameters {\n  info: SingleMeshInfo;\n\n  static RPC_ID = \"single_mesh/SingleMeshSource\";\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { DataType } from \"#src/util/data_type.js\";\n\nexport const SKELETON_LAYER_RPC_ID = \"skeleton/SkeletonLayer\";\n\nexport interface VertexAttributeInfo {\n  dataType: DataType;\n  numComponents: number;\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  mat4,\n  transformVectorByMat4,\n  transformVectorByMat4Transpose,\n  vec3,\n} from \"#src/util/geom.js\";\nimport * as matrix from \"#src/util/matrix.js\";\n\nexport class ChunkLayout {\n  /**\n   * Size of each chunk in \"chunk\" coordinates.\n   */\n  size: vec3;\n\n  /**\n   * Transform from local \"chunk\" coordinates to global voxel coordinates.\n   */\n  transform: mat4;\n\n  /**\n   * Inverse of transform.  Transform from global voxel coordinates to \"chunk\" coordinates.\n   */\n  invTransform: mat4;\n\n  /**\n   * Determinant of `transform`.\n   */\n  detTransform: number;\n\n  finiteRank: number;\n\n  constructor(size: vec3, transform: mat4, finiteRank: number) {\n    this.size = vec3.clone(size);\n    this.transform = mat4.clone(transform);\n    this.finiteRank = finiteRank;\n    const invTransform = mat4.create();\n    const det = matrix.inverse(invTransform, 4, transform, 4, 4);\n    if (det === 0) {\n      throw new Error(\"Transform is singular\");\n    }\n    this.invTransform = invTransform;\n    this.detTransform = det;\n  }\n  toObject() {\n    return {\n      size: this.size,\n      transform: this.transform,\n      finiteRank: this.finiteRank,\n    };\n  }\n\n  static fromObject(msg: any) {\n    return new ChunkLayout(msg.size, msg.transform, msg.finiteRank);\n  }\n\n  /**\n   * Transform global spatial coordinates to local spatial coordinates.\n   */\n  globalToLocalSpatial(out: vec3, globalSpatial: vec3): vec3 {\n    return vec3.transformMat4(out, globalSpatial, this.invTransform);\n  }\n\n  localSpatialVectorToGlobal(out: vec3, localVector: vec3): vec3 {\n    return transformVectorByMat4(out, localVector, this.transform);\n  }\n\n  /**\n   * Returns the unnormalized normal vector.\n   */\n  globalToLocalNormal(globalNormal: vec3, localNormal: vec3) {\n    return transformVectorByMat4Transpose(\n      globalNormal,\n      localNormal,\n      this.transform,\n    );\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport interface DebouncedFunction {\n  /**\n   * Ensures the wrapped function will be run at the next animation frame.\n   */\n  (): void;\n\n  /**\n   * Cancels any outstanding call.\n   */\n  cancel(): void;\n\n  /**\n   * Runs any outstanding call immediately.\n   */\n  flush(): void;\n}\n\n/**\n * Returns a function that, when called, ensures `callback` is invoked at the next animation frame.\n */\nexport function animationFrameDebounce(\n  callback: () => void,\n): DebouncedFunction {\n  let handle = -1;\n  const cancel = () => {\n    if (handle !== -1) {\n      cancelAnimationFrame(handle);\n      handle = -1;\n    }\n  };\n  const flush = () => {\n    if (handle !== -1) {\n      handle = -1;\n      callback();\n    }\n  };\n  return Object.assign(\n    () => {\n      if (handle === -1) {\n        handle = requestAnimationFrame(() => {\n          handle = -1;\n          callback();\n        });\n      }\n    },\n    { flush, cancel },\n  );\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { VisibleSegmentEquivalencePolicy } from \"#src/segmentation_graph/segment_id.js\";\nimport type { WatchableValueInterface } from \"#src/trackable_value.js\";\nimport { WatchableValue } from \"#src/trackable_value.js\";\nimport { bigintCompare } from \"#src/util/bigint.js\";\n\nclass Entry {\n  rank: number = 0;\n  parent: Entry = this;\n  next: Entry = this;\n  prev: Entry = this;\n  min: bigint;\n\n  constructor(public value: bigint) {\n    this.min = value;\n  }\n}\n\nfunction findRepresentative(v: Entry): Entry {\n  // First pass: find the root, which will be stored in ancestor.\n  let old = v;\n  let ancestor = v.parent;\n  while (ancestor !== v) {\n    v = ancestor;\n    ancestor = v.parent;\n  }\n  // Second pass: set all of the parent pointers along the path from the\n  // original element `old' to refer directly to the root `ancestor'.\n  v = old.parent;\n  while (ancestor !== v) {\n    old.parent = ancestor;\n    old = v;\n    v = old.parent;\n  }\n  return ancestor;\n}\n\nfunction linkUnequalSetRepresentatives(i: Entry, j: Entry): Entry {\n  const iRank = i.rank;\n  const jRank = j.rank;\n  if (iRank > jRank) {\n    j.parent = i;\n    return i;\n  }\n\n  i.parent = j;\n  if (iRank === jRank) {\n    j.rank = jRank + 1;\n  }\n  return j;\n}\n\nfunction spliceCircularLists(i: Entry, j: Entry) {\n  const iPrev = i.prev;\n  const jPrev = j.prev;\n\n  // Connect end of i to beginning of j.\n  j.prev = iPrev;\n  iPrev.next = j;\n\n  // Connect end of j to beginning of i.\n  i.prev = jPrev;\n  jPrev.next = i;\n}\n\nfunction* setElementIterator(i: Entry): Generator<bigint> {\n  let j = i;\n  do {\n    yield j.value;\n    j = j.next;\n  } while (j !== i);\n}\n\nfunction isRootElement(v: Entry) {\n  return v.parent === v;\n}\n\n/**\n * Represents a collection of disjoint sets of uint64 values.\n *\n * Supports merging sets, retrieving the minimum uint64 value contained in a set (the representative\n * value), and iterating over the elements contained in a set.\n */\nexport class DisjointUint64Sets {\n  private map = new Map<bigint, Entry>();\n  visibleSegmentEquivalencePolicy: WatchableValueInterface<VisibleSegmentEquivalencePolicy> =\n    new WatchableValue<VisibleSegmentEquivalencePolicy>(\n      VisibleSegmentEquivalencePolicy.MIN_REPRESENTATIVE,\n    );\n  generation = 0;\n\n  has(x: bigint): boolean {\n    return this.map.has(x);\n  }\n\n  get(x: bigint): bigint {\n    const entry = this.map.get(x);\n    if (entry === undefined) {\n      return x;\n    }\n    return findRepresentative(entry).min;\n  }\n\n  isMinElement(x: bigint) {\n    return x === this.get(x);\n  }\n\n  private makeSet(x: bigint): Entry {\n    const { map } = this;\n    let entry = map.get(x);\n    if (entry === undefined) {\n      entry = new Entry(x);\n      map.set(x, entry);\n      return entry;\n    }\n    return findRepresentative(entry);\n  }\n\n  /**\n   * Union the sets containing `a` and `b`.\n   * @returns `false` if `a` and `b` are already in the same set, otherwise `true`.\n   */\n  link(a: bigint, b: bigint): boolean {\n    const aEntry = this.makeSet(a);\n    const bEntry = this.makeSet(b);\n    if (aEntry === bEntry) {\n      return false;\n    }\n    this.generation++;\n    const newNode = linkUnequalSetRepresentatives(aEntry, bEntry);\n    spliceCircularLists(aEntry, bEntry);\n    const aMin = aEntry.min;\n    const bMin = bEntry.min;\n    const isMax =\n      (this.visibleSegmentEquivalencePolicy.value &\n        VisibleSegmentEquivalencePolicy.MAX_REPRESENTATIVE) !==\n      0;\n    newNode.min = aMin < bMin === isMax ? bMin : aMin;\n    return true;\n  }\n\n  linkAll(ids: bigint[]) {\n    for (let i = 1, length = ids.length; i < length; ++i) {\n      this.link(ids[0], ids[i]);\n    }\n  }\n\n  /**\n   * Unlinks all members of the specified set.\n   */\n  deleteSet(x: bigint) {\n    const { map } = this;\n    let changed = false;\n    for (const y of this.setElements(x)) {\n      map.delete(y);\n      changed = true;\n    }\n    if (changed) {\n      ++this.generation;\n    }\n    return changed;\n  }\n\n  *setElements(a: bigint): IterableIterator<bigint> {\n    const entry = this.map.get(a);\n    if (entry === undefined) {\n      yield a;\n    } else {\n      yield* setElementIterator(entry);\n    }\n  }\n\n  clear() {\n    const { map } = this;\n    if (map.size === 0) {\n      return false;\n    }\n    ++this.generation;\n    map.clear();\n    return true;\n  }\n\n  get size() {\n    return this.map.size;\n  }\n\n  *mappings(): IterableIterator<[bigint, bigint]> {\n    for (const entry of this.map.values()) {\n      yield [entry.value, findRepresentative(entry).min];\n    }\n  }\n\n  *roots(): IterableIterator<bigint> {\n    for (const entry of this.map.values()) {\n      if (isRootElement(entry)) {\n        yield entry.value;\n      }\n    }\n  }\n\n  [Symbol.iterator](): IterableIterator<[bigint, bigint]> {\n    return this.mappings();\n  }\n\n  /**\n   * Returns an array of arrays of strings, where the arrays contained in the outer array correspond\n   * to the disjoint sets, and the strings are the base-10 string representations of the members of\n   * each set.  The members are sorted in numerical order, and the sets are sorted in numerical\n   * order of their smallest elements.\n   */\n  toJSON(): string[][] {\n    const sets = new Array<bigint[]>();\n    for (const entry of this.map.values()) {\n      if (isRootElement(entry)) {\n        const members = new Array<bigint>();\n        for (const member of setElementIterator(entry)) {\n          members.push(member);\n        }\n        members.sort(bigintCompare);\n        sets.push(members);\n      }\n    }\n    sets.sort((a, b) => bigintCompare(a[0], b[0]));\n    return sets.map((set) => set.map((element) => element.toString()));\n  }\n}\n","// No-op module to which other modules are conditionally redirected in order to\n// disable them.\nexport default false;\n","/**\n * @license\n * Copyright 2018 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst tempArray = new Float32Array(1);\n\n/**\n * Converts `x` into its nearest single precision float representation and\n * returns a minimal string representation, with as many digits as necessary\n * to uniquely distinguish single precision `x` from its adjacent single\n * precision values.\n *\n * E.g.: 0.299999999000000017179701217174d → 0.30000001192092896f → '0.3')\n */\nexport function float32ToString(x: number) {\n  tempArray[0] = x;\n  x = tempArray[0];\n  for (let digits = 1; digits < 21; ++digits) {\n    const result = x.toPrecision(digits);\n    tempArray[0] = parseFloat(result);\n    if (tempArray[0] === x) {\n      return result;\n    }\n  }\n  return x.toString();\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ProgressListener } from \"#src/util/progress_listener.js\";\n\nexport class HttpError extends Error {\n  url: string;\n  status: number;\n  statusText: string;\n  response?: Response;\n\n  constructor(\n    url: string,\n    status: number,\n    statusText: string,\n    response?: Response,\n    options?: { cause: any },\n  ) {\n    let message = `Fetching ${JSON.stringify(\n      url,\n    )} resulted in HTTP error ${status}`;\n    if (statusText) {\n      message += `: ${statusText}`;\n    }\n    message += \".\";\n    super(message, options);\n    this.name = \"HttpError\";\n    this.message = message;\n    this.url = url;\n    this.status = status;\n    this.statusText = statusText;\n    if (response) {\n      this.response = response;\n    }\n  }\n\n  static fromResponse(response: Response) {\n    return new HttpError(\n      response.url,\n      response.status,\n      response.statusText,\n      response,\n    );\n  }\n\n  static fromRequestError(input: RequestInfo, error: unknown) {\n    if (error instanceof TypeError) {\n      let url: string;\n      if (typeof input === \"string\") {\n        url = input;\n      } else {\n        url = input.url;\n      }\n      return new HttpError(url, 0, \"Network or CORS error\", undefined, {\n        cause: error,\n      });\n    }\n    return error;\n  }\n}\n\nconst maxAttempts = 32;\nconst minDelayMilliseconds = 500;\nconst maxDelayMilliseconds = 10000;\n\nexport function pickDelay(attemptNumber: number): number {\n  // If `attemptNumber == 0`, delay is a random number of milliseconds between\n  // `[minDelayMilliseconds, minDelayMilliseconds*2]`.  The lower and upper bounds of the interval\n  // double with each successive attempt, up to the limit of\n  // `[maxDelayMilliseconds/2,maxDelayMilliseconds]`.\n  return (\n    Math.min(\n      2 ** attemptNumber * minDelayMilliseconds,\n      maxDelayMilliseconds / 2,\n    ) *\n    (1 + Math.random())\n  );\n}\n\n/**\n * Issues a `fetch` request.\n *\n * If the request fails due to an HTTP status outside `[200, 300)`, throws an `HttpError`.  If the\n * request fails due to a network or CORS restriction, throws an `HttpError` with a `status` of `0`.\n *\n * If the request fails due to a transient error (429, 503, 504), retry.\n */\nexport async function fetchOk(\n  input: RequestInfo,\n  init?: RequestInitWithProgress,\n): Promise<Response> {\n  for (let requestAttempt = 0; ; ) {\n    init?.signal?.throwIfAborted();\n    let response: Response;\n    try {\n      response = await fetch(input, init);\n    } catch (error) {\n      throw HttpError.fromRequestError(input, error);\n    }\n    if (!response.ok) {\n      const { status } = response;\n      if (status === 429 || status === 503 || status === 504) {\n        // 429: Too Many Requests.  Retry.\n        // 503: Service unavailable.  Retry.\n        // 504: Gateway timeout.  Can occur if the server takes too long to reply.  Retry.\n        if (++requestAttempt !== maxAttempts) {\n          await new Promise((resolve) =>\n            setTimeout(resolve, pickDelay(requestAttempt - 1)),\n          );\n          continue;\n        }\n      }\n      throw HttpError.fromResponse(response);\n    }\n    return response;\n  }\n}\n\nexport interface RequestInitWithProgress extends RequestInit {\n  progressListener?: ProgressListener;\n}\n\nexport type FetchOk = (\n  input: RequestInfo,\n  init?: RequestInitWithProgress,\n) => Promise<Response>;\n\nexport function isNotFoundError(e: any) {\n  if (!(e instanceof HttpError)) return false;\n  // Treat CORS errors (0) or 403 as not found.  S3 returns 403 if the file does not exist because\n  // permissions are per-file.\n  return e.status === 0 || e.status === 403 || e.status === 404;\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type Node<\n  T,\n  Next extends string | symbol,\n  Prev extends string | symbol,\n> = Record<Next | Prev, T | null>;\n\nexport interface LinkedListOperations<T> {\n  insertAfter: (head: T, x: T) => void;\n  pop: (head: T) => T;\n  insertBefore: (head: T, x: T) => void;\n  front: (head: T) => T | null;\n  back: (head: T) => T | null;\n  iterator: (head: T) => Iterator<T>;\n  reverseIterator: (head: T) => Iterator<T>;\n  initializeHead: (head: T) => void;\n}\n\nexport default function linkedListOperations<\n  Next extends string | symbol,\n  Prev extends string | symbol,\n>(options: { next: Next; prev: Prev }) {\n  const { next: NEXT, prev: PREV } = options;\n  return {\n    insertAfter<T extends Node<T, Next, Prev>>(head: T, x: T) {\n      const next = head[NEXT]!;\n      (x[NEXT] as T) = next;\n      (x[PREV] as T) = head;\n      (head[NEXT] as T) = x;\n      (next[PREV] as T) = x;\n    },\n    insertBefore<T extends Node<T, Next, Prev>>(head: T, x: T) {\n      const prev = <T>head[PREV];\n      (x[PREV] as T) = prev;\n      (x[NEXT] as T) = head;\n      (head[PREV] as T) = x;\n      (prev[NEXT] as T) = x;\n    },\n    front<T extends Node<T, Next, Prev>>(head: T) {\n      const next = head[NEXT];\n      if (next === head) {\n        return null;\n      }\n      return next;\n    },\n    back<T extends Node<T, Next, Prev>>(head: T): T | null {\n      const next = head[PREV];\n      if (next === head) {\n        return null;\n      }\n      return next;\n    },\n    pop<T extends Node<T, Next, Prev>>(x: T) {\n      const next = x[NEXT] as T;\n      const prev = x[PREV] as T;\n      (next[PREV] as T) = prev;\n      (prev[NEXT] as T) = next;\n      (x[NEXT] as T | null) = null;\n      (x[PREV] as T | null) = null;\n      return x;\n    },\n    *iterator<T extends Node<T, Next, Prev>>(head: T) {\n      for (let x = <T>head[NEXT]; x !== head; x = <T>x[NEXT]) {\n        yield x;\n      }\n    },\n    *reverseIterator<T extends Node<T, Next, Prev>>(head: T) {\n      for (let x = <T>head[PREV]; x !== head; x = <T>x[PREV]) {\n        yield x;\n      }\n    },\n    initializeHead<T extends Node<T, Next, Prev>>(head: T) {\n      (head[NEXT] as T) = (head[PREV] as T) = head;\n    },\n  };\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { raceWithAbort, SharedAbortController } from \"#src/util/abort.js\";\nimport type { RefCounted } from \"#src/util/disposable.js\";\nimport { RefCountedValue } from \"#src/util/disposable.js\";\nimport { stableStringify } from \"#src/util/json.js\";\nimport type { ProgressOptions } from \"#src/util/progress_listener.js\";\nimport { MultiConsumerProgressListener } from \"#src/util/progress_listener.js\";\n\nexport class Memoize<Key, Value extends RefCounted> {\n  private map = new Map<Key, Value>();\n\n  /**\n   * If getter throws an exception, no value is added.\n   */\n  get<T extends Value>(key: Key, getter: () => T): T {\n    const { map } = this;\n    let obj = <T>map.get(key);\n    if (obj === undefined) {\n      obj = getter();\n      obj.registerDisposer(() => {\n        map.delete(key);\n      });\n      map.set(key, obj);\n    } else {\n      obj.addRef();\n    }\n    return obj;\n  }\n}\n\nexport class StringMemoize extends Memoize<string, RefCounted> {\n  get<T extends RefCounted>(x: any, getter: () => T) {\n    if (typeof x !== \"string\") {\n      x = stableStringify(x);\n    }\n    return super.get(x, getter);\n  }\n\n  getUncounted<T>(x: any, getter: () => T) {\n    return this.get(x, () => new RefCountedValue(getter())).value;\n  }\n\n  getAsync<T>(\n    x: any,\n    options: Partial<ProgressOptions>,\n    getter: (options: ProgressOptions) => Promise<T>,\n  ) {\n    return this.getUncounted(x, () => asyncMemoizeWithProgress(getter))(\n      options,\n    );\n  }\n}\n\nexport interface AsyncMemoize<T> {\n  (options: { signal?: AbortSignal }): Promise<T>;\n}\n\nexport interface AsyncMemoizeWithProgress<T> {\n  (options: Partial<ProgressOptions>): Promise<T>;\n}\n\nexport function asyncMemoize<T>(\n  getter: (options: { signal: AbortSignal }) => Promise<T>,\n): AsyncMemoize<T> {\n  let abortController: SharedAbortController | undefined;\n  let promise: Promise<T> | undefined;\n  let completed: boolean = false;\n\n  return (options: { signal?: AbortSignal }): Promise<T> => {\n    if (completed) {\n      return promise!;\n    }\n    const { signal } = options;\n    if (signal?.aborted) {\n      return Promise.reject(signal.reason);\n    }\n    if (promise === undefined || abortController!.signal.aborted) {\n      abortController = new SharedAbortController();\n      const curAbortController = abortController;\n      promise = (async () => {\n        try {\n          return await getter({\n            signal: curAbortController.signal,\n          });\n        } catch (e) {\n          if (curAbortController.signal.aborted) {\n            promise = undefined;\n          }\n          throw e;\n        } finally {\n          if (promise !== undefined) {\n            completed = true;\n          }\n          curAbortController[Symbol.dispose]();\n          if (abortController === curAbortController) {\n            abortController = undefined;\n          }\n        }\n      })();\n    }\n    abortController!.addConsumer(signal);\n    return raceWithAbort(promise, signal);\n  };\n}\n\nexport function asyncMemoizeWithProgress<T>(\n  getter: (options: ProgressOptions) => Promise<T>,\n): AsyncMemoizeWithProgress<T> {\n  let progressListener: MultiConsumerProgressListener | undefined;\n  let abortController: SharedAbortController | undefined;\n  let promise: Promise<T> | undefined;\n  let completed: boolean = false;\n\n  return async (options: Partial<ProgressOptions>): Promise<T> => {\n    if (completed) {\n      return promise!;\n    }\n    const { signal } = options;\n    signal?.throwIfAborted();\n    if (promise === undefined || abortController!.signal.aborted) {\n      progressListener = new MultiConsumerProgressListener();\n      abortController = new SharedAbortController();\n      const curAbortController = abortController;\n      promise = (async () => {\n        try {\n          return await getter({\n            signal: curAbortController.signal,\n            progressListener: progressListener!,\n          });\n        } catch (e) {\n          if (curAbortController.signal.aborted) {\n            promise = undefined;\n          }\n          throw e;\n        } finally {\n          if (promise !== undefined) {\n            completed = true;\n          }\n          progressListener = undefined;\n          curAbortController[Symbol.dispose]();\n          if (abortController === curAbortController) {\n            abortController = undefined;\n          }\n        }\n      })();\n    }\n    abortController!.addConsumer(signal);\n    const curProgressListener = progressListener!;\n    curProgressListener.addListener(options.progressListener);\n\n    try {\n      return await raceWithAbort(promise, signal);\n    } finally {\n      curProgressListener.removeListener(options.progressListener);\n    }\n  };\n}\n","/**\n * @license\n * Copyright 2019 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport function defaultStringCompare(a: string, b: string) {\n  return a < b ? -1 : a > b ? +1 : 0;\n}\n","/**\n * @license\n * Copyright 2017 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { verifyEnumString } from \"#src/util/json.js\";\nimport { NullarySignal } from \"#src/util/signal.js\";\nimport type { Trackable } from \"#src/util/trackable.js\";\n\nexport class TrackableEnum<T extends number> implements Trackable {\n  changed = new NullarySignal();\n\n  constructor(\n    public enumType: { [x: string]: any },\n    private value_: T,\n    private defaultValue: T = value_,\n  ) {}\n\n  set value(value: T) {\n    if (this.value_ !== value) {\n      this.value_ = value;\n      this.changed.dispatch();\n    }\n  }\n\n  get value() {\n    return this.value_;\n  }\n\n  reset() {\n    this.value = this.defaultValue;\n  }\n\n  restoreState(obj: any) {\n    this.value = verifyEnumString(obj, this.enumType);\n  }\n\n  toJSON(): string | undefined {\n    if (this.value_ === this.defaultValue) return undefined;\n    return this.enumType[this.value_].toLowerCase();\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use viewer file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TrackableEnum } from \"#src/util/trackable_enum.js\";\n\nexport enum ScreenshotMode {\n  OFF = 0, // Default mode\n  ON = 1, // Screenshot mode\n  FORCE = 2, // Force screenshot mode - used when the screenshot is stuck\n  PREVIEW = 3, // Preview mode - used while the user is in the screenshot menu\n}\n\nexport class TrackableScreenshotMode extends TrackableEnum<ScreenshotMode> {\n  constructor(value: ScreenshotMode, defaultValue: ScreenshotMode = value) {\n    super(ScreenshotMode, value, defaultValue);\n  }\n}\n","/**\n * @license\n * Copyright 2016 Google Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { RefCounted } from \"#src/util/disposable.js\";\nimport { Memoize } from \"#src/util/memoize.js\";\n\nexport interface GL extends WebGL2RenderingContext {\n  memoize: Memoize<any, RefCounted>;\n  maxTextureSize: number;\n  maxTextureImageUnits: number;\n  max3dTextureSize: number;\n  tempTextureUnit: number;\n}\n\nexport const DEBUG_SHADERS = false;\n\nexport function initializeWebGL(canvas: HTMLCanvasElement) {\n  const options: any = {\n    antialias: false,\n    stencil: true,\n  };\n  if (DEBUG_SHADERS) {\n    console.log(\"DEBUGGING via preserveDrawingBuffer\");\n    options.preserveDrawingBuffer = true;\n  }\n  const gl = <GL>canvas.getContext(\"webgl2\", options);\n  if (gl == null) {\n    throw new Error(\"WebGL not supported.\");\n  }\n  gl.memoize = new Memoize<any, RefCounted>();\n  gl.maxTextureSize = gl.getParameter(WebGL2RenderingContext.MAX_TEXTURE_SIZE);\n  gl.max3dTextureSize = gl.getParameter(\n    WebGL2RenderingContext.MAX_3D_TEXTURE_SIZE,\n  );\n  gl.maxTextureImageUnits = gl.getParameter(\n    WebGL2RenderingContext.MAX_TEXTURE_IMAGE_UNITS,\n  );\n  gl.tempTextureUnit = gl.maxTextureImageUnits - 1;\n\n  // FIXME: verify that we received a stencil buffer\n  // var contextAttributes = gl.getContextAttributes();\n  // var haveStencilBuffer = contextAttributes.stencil;\n\n  for (const extension of [\"EXT_color_buffer_float\"]) {\n    if (!gl.getExtension(extension)) {\n      throw new Error(`${extension} extension not available`);\n    }\n  }\n\n  // Extensions to attempt to add but not fail if they are not available.\n  for (const extension of [\n    // Some versions of Firefox 67.0 seem to require this extension being added in addition\n    // to EXT_color_buffer_float, despite the note here indicating it is unnecessary:\n    // https://developer.mozilla.org/en-US/docs/Web/API/EXT_float_blend\n    //\n    // See https://github.com/google/neuroglancer/issues/140\n    \"EXT_float_blend\",\n  ]) {\n    gl.getExtension(extension);\n  }\n  return gl;\n}\n"],"names":["fetchOkWithCredentials","credentialsProvider","input","init","applyCredentials","errorHandler","credentials","credentialsAttempt","Promise","resolve","setTimeout","pickDelay","undefined","fetchOk","error","HttpError","fetchOkWithCredentialsAdapter","headers","Headers","status","Error","JSON","fetchOkWithOAuth2Credentials","fetchOkWithOAuth2CredentialsAdapter","CREDENTIALS_PROVIDER_RPC_ID","CREDENTIALS_PROVIDER_GET_RPC_ID","CREDENTIALS_MANAGER_RPC_ID","CREDENTIALS_MANAGER_GET_RPC_ID","BossSourceParameters","VolumeChunkSourceParameters","parameters","MeshSourceParameters","VolumeChunkEncoding","VolumeSourceParameters","MultiscaleMeshSourceParameters","SkeletonSourceParameters","AnnotationSourceParameters","AnnotationSpatialIndexSourceParameters","ImageTileEncoding","ImageTileSourceParameters","DVIDSourceParameters","GET_NIFTI_VOLUME_INFO_RPC_ID","DataEncoding","ShardingHashFunction","RenderBaseSourceParameters","RenderSourceParameters","TileChunkSourceParameters","CodecKind","ChunkKeyEncoding","hashCombine","state","value","Math","parseKey","key","m","begin","Number","end","ByteRangeKvStore","base","options","length","byteRange","FileByteRangeHandle","frontendBackendIsomorphicKvStoreProviderRegistry","url","ensureNoQueryOrFragmentParameters","KvStoreFileHandle","KvStoreContext","Map","AutoDetectRegistry","kvStore","pipeline","splitPipelineUrl","basePart","i","store","path","provider","usage","message","adapterUrl","Array","protocol","readKvStore","urlPrefix","listKvStore","baseUrl","relativePath","resolveRelativePath","GcsKvStore","bucket","baseUrlForDisplay","fetchOkImpl","encodeURIComponent","getRandomHexString","stat","read","prefix","progressListener","_span","ProgressSpan","response","location","responseJson","verifyObject","directories","verifyOptionalObjectProperty","verifyStringArray","entries","items","parseArray","item","verifyObjectProperty","verifyString","name","encodePathForUrl","_context","pythonIntegration","decodeURIComponent","GzipFileHandle","format","readResponse","Response","decodeGzipStream","decodedArray","Uint8Array","parts","encodedBytesReceived","expectedEncodedBytes","part","decompressionStream","DecompressionStream","writer","writePromises","reader","decodedOffset","remainingLength","GzipKvStore","scheme","detectGzip","isGzipFormat","ensureEmptyUrlSuffix","registerAutoDetect","registry","ReadableHttpKvStore","sharedKvStoreContext","joinBaseUrlAndPath","registerProviders","httpKvStoreClass","httpScheme","context","httpProvider","getBaseHttpUrlAndPath","e","SCHEME_PREFIX","middleauthProvider","httpUrl","credentialsManager","URL","gcsNgauthProvider","authHost","authUrl","getOcdbtUrl","version","versionString","formatVersion","parseOcdbtUrl","parsedUrl","ensurePathIsDirectory","parseVersion","KvStoreProviderRegistry","kvStoreContext","map","providerFactory","ReadableS3KvStore","knownToBeVirtualHostedStyle","getS3BucketListing","listS3CompatibleUrl","s3KvStoreClass","s3Provider","host","SHARED_KVSTORE_CONTEXT_RPC_ID","STAT_RPC_ID","READ_RPC_ID","LIST_RPC_ID","COMPLETE_URL_RPC_ID","MESH_LAYER_RPC_ID","MULTISCALE_MESH_LAYER_RPC_ID","FRAGMENT_SOURCE_RPC_ID","MULTISCALE_FRAGMENT_SOURCE_RPC_ID","VertexPositionFormat","PERSPECTIVE_VIEW_RPC_ID","RENDERED_VIEW_ADD_LAYER_RPC_ID","RENDERED_VIEW_REMOVE_LAYER_RPC_ID","PROJECTION_PARAMETERS_RPC_ID","PROJECTION_PARAMETERS_CHANGED_RPC_METHOD_ID","SINGLE_MESH_LAYER_RPC_ID","GET_SINGLE_MESH_INFO_RPC_ID","SINGLE_MESH_CHUNK_KEY","SingleMeshSourceParameters","SingleMeshSourceParametersWithInfo","SKELETON_LAYER_RPC_ID","ChunkLayout","size","transform","finiteRank","vec3","mat4","invTransform","det","matrix","msg","out","globalSpatial","localVector","transformVectorByMat4","globalNormal","localNormal","transformVectorByMat4Transpose","animationFrameDebounce","callback","handle","Object","requestAnimationFrame","flush","cancel","cancelAnimationFrame","Entry","findRepresentative","v","old","ancestor","setElementIterator","j","isRootElement","DisjointUint64Sets","WatchableValue","VisibleSegmentEquivalencePolicy","x","entry","a","b","aEntry","bEntry","newNode","linkUnequalSetRepresentatives","iRank","jRank","spliceCircularLists","iPrev","jPrev","aMin","bMin","isMax","ids","changed","y","Symbol","sets","members","member","bigintCompare","set","element","tempArray","Float32Array","float32ToString","digits","result","parseFloat","statusText","TypeError","attemptNumber","maxDelayMilliseconds","requestAttempt","fetch","isNotFoundError","linkedListOperations","NEXT","PREV","head","next","prev","Memoize","getter","obj","StringMemoize","stableStringify","RefCountedValue","asyncMemoizeWithProgress","abortController","promise","completed","signal","MultiConsumerProgressListener","curAbortController","SharedAbortController","curProgressListener","raceWithAbort","defaultStringCompare","TrackableEnum","enumType","value_","defaultValue","NullarySignal","verifyEnumString","ScreenshotMode","TrackableScreenshotMode","initializeWebGL","canvas","gl","extension","WebGL2RenderingContext"],"mappings":"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"}